'use strict;'
class FlexBoxEntity{constructor(t,s=!1){this.id=t,this.top=1/0,this.left=1/0,this.width=1/0,this.height=1/0,this.element=s?this.m43():null}m43(){var t=document.createElement("div");return t.id=this.id,t.classList.add("FlexBoxEntity"),A3.f3(t),t}m16(){return this.id}m13(){return this.element}f22(){return this.width}f17(){return this.height}m20(){return[this.top,this.left]}f81(t,s,e,i){this.m61(e,i),this.m64(t,s)}m64(t,s){this.width=t,this.height=s,null!==this.element&&(this.element.style.width=t+"px",this.element.style.height=s+"px")}m61(t,s){this.top=t,this.left=s,null!==this.element&&(this.element.style.top=t+"px",this.element.style.left=s+"px")}}class FlexBox extends FlexBoxEntity{constructor(t,s,e,i,n=!1){super(t,n),n&&this.element.classList.add("FlexBox"),this.condense=0,this.lst_entities_ctrl_size=[],this.lst_entities_ctrl_position=[],this.orientation=s,this.justify=e,this.align=i}m54(t){this.condense=t}f81(t,s,e,i){super.f81(t,s,e,i)}m3(t,s,e,i=!0){i=i?"push":"unshift";s&&this.lst_entities_ctrl_size[i](t),e&&(this.lst_entities_ctrl_position[i](t),this.m56())}m48(t,s,e){s&&k6(this.lst_entities_ctrl_size,t),e&&(k6(this.lst_entities_ctrl_position,t),this.m56())}m57(s,e){0<this.lst_entities_ctrl_size.length&&this.lst_entities_ctrl_size.forEach(t=>t.m64(s,e))}m61(t,s){super.m61(t,s),this.m56()}m56(){var s,e,i,n;0<this.lst_entities_ctrl_position.length&&(e=s=0,this.lst_entities_ctrl_position.forEach(t=>{s+=t.f22(),e+=t.f17()}),"row"===this.orientation?(i=this["MakeDistributionList_"+this.justify](!0,"width",s),n=this["MakeDistributionList_"+this.align](!1,"height",e)):(n=this["MakeDistributionList_"+this.justify](!0,"height",e),i=this["MakeDistributionList_"+this.align](!1,"width",s)),this.lst_entities_ctrl_position.forEach(t=>{t.m61(n.shift(),i.shift())}))}m44(t,s){for(var e,i=this["width"===s?"left":"top"],n=[],r=0;r<this.lst_entities_ctrl_position.length;++r)t&&0<r&&(e=this.lst_entities_ctrl_position[r-1],i+="width"===s?e.f22():e.f17()),n.push(i);return n}MakeDistributionList_start(t,s,e){return this.m44(t,s)}MakeDistributionList_center(t,s,e){for(var i,n=this.m44(t,s),r=Math.round((this[s]-e)/2),a=0;a<this.lst_entities_ctrl_position.length;++a)t?n[a]+=r:(i=this.lst_entities_ctrl_position[a],n[a]+=Math.round((this[s]-("width"===s?i.f22():i.f17()))/2));return n}MakeDistributionList_end(t,s,e){for(var i,n,r=this.m44(t,s),a=Math.round(this[s]-e),h=this.lst_entities_ctrl_position.length,l=0;l<h;++l)t?(r[l]+=a,this.condense&&l<h-1&&(i=this.lst_entities_ctrl_position[l],n="width"===s?i.f22():i.f17(),r[l]+=(h-1-l)*n*this.condense)):(i=this.lst_entities_ctrl_position[l],r[l]+=this[s]-("width"===s?i.f22():i.f17()));return r}MakeDistributionList_evenly(t,s,e){for(var i=this.m44(t,s),n=this.lst_entities_ctrl_position.length,r=Math.round((this[s]-e)/(n+1)),a=0;a<n;++a)i[a]+=(a+1)*r;return i}}class Card extends FlexBoxEntity{constructor(t,s,e){super("Card_"+t,!0),this.id=t,this.suit=s.value,this.value=e.value,this.face_up=!1,this.selected=!1,this.location=null,this.e_body=null,this.e_face=null,this.e_back=null,this.e_value=null,this.e_suit=null,this.color=s.color,this.m41(s.color),this.element.classList.add("Card"),this.element.classList.add("CardHidden"),this.e_body.classList.add("FaceDown"),(this.m39()||this.m38())&&this.e_face.classList.add("CardRoyal"),this.e_suit.innerHTML=s.symbol,this.e_value.innerHTML=e.symbol,A3.A6.f21("show_royals_value")&&this.m39()&&(this.e_value.innerHTML+="<span>"+this.value+"<span>"),A0.f1(this.e_body,"MOUSE||TOUCH",this.onClick.bind(this)),this.e_body.addEventListener("contextmenu",A3.f80.bind(A3))}onClick(t){t.stopPropagation(),t.preventDefault(),A3.f75(this)}f21(){return this.value!==ROYAL_JOKER?this.value:JOKER_MAX}m23(){return this.suit}m9(){return this.color}m64(t,s){super.m64(t,s),this.e_value.style.fontSize=Math.round(.3*t)+"px",this.e_value.children.length&&(this.e_value.children[0].style.fontSize=Math.round(.2*t)+"px"),this.e_suit.style.fontSize=Math.round(.4*t)+"px"}m58(t){this.face_up=t,this.e_body.classList[t?"remove":"add"]("FaceDown")}m62(t){this.selected=t,this.e_body.classList[t?"add":"remove"]("CardSelected")}m71(){return this.m62(!this.selected),this.selected}m41(t){this.e_body=document.createElement("div"),this.e_body.classList.add("CardBody"),this.e_body.classList.add("Clickable"),this.element.appendChild(this.e_body),this.e_face=document.createElement("div"),this.e_face.classList.add("CardFace"),this.e_body.appendChild(this.e_face),this.e_back=document.createElement("div"),this.e_back.classList.add("CardBack"),this.e_body.appendChild(this.e_back),this.e_value=document.createElement("p"),this.e_value.classList.add("CardValue"),this.e_value.classList.add("CardValue"+t),this.e_face.appendChild(this.e_value),this.e_suit=document.createElement("p"),this.e_suit.classList.add("CardSuit"),this.e_suit.classList.add("CardSuit"+t),this.e_face.appendChild(this.e_suit)}m60(t){this.location=t}m31(t){return this.location===t}m17(){return this.location}m39(){return[ROYAL_JACK,ROYAL_QUEEN,ROYAL_KING].includes(this.value)}m38(){return this.value===ROYAL_JOKER}m30(){return 1===this.value}m34(){return this.face_up}m33(){return!this.face_up}m40(){return this.selected}m59(t){this.element.classList[t?"add":"remove"]("CardHidden")}m65(t){this.element.classList[t?"add":"remove"]("CardSmooth")}m67(t){this.element.style.zIndex=t}}window.addEventListener("error",t=>(alert("# ERROR: "+t.error.message+"\nUrl: "+t.error.fileName+"\nLine: "+t.error.lineNumber+"\n\n# Stack:\n\n"+t.error.stack+"\n"),!1));const A0={viewport:null,viewport_width:0,pages_container:null,nr_pages:0,lst_pages:null,current_page_idx:0,previous_page_idx:0,client_onResize:null,mouse_or_touch:null,PAGE_FREE:0,PAGE_LANDSCAPE:1,PAGE_PORTRAIT:-1,page_before_rotate:-1,page_mode:0,page_rotate_id:0,f24:function(t){this.viewport=document.getElementById("AppViewport"),this.pages_container=document.getElementById("AppPagesContainer"),this.lst_pages=Array.from(document.querySelectorAll(".AppPage")),this.nr_pages=this.lst_pages.length,window.hasOwnProperty("cordova")?this.mouse_or_touch="mousedown":this.mouse_or_touch=void 0!==window.ontouchstart?"touchstart":"mousedown",A0.f81(null),this.client_onResize=t,window.visualViewport.addEventListener("resize",A0.f81.bind(this))},f81:function(t){this.viewport_width=this.viewport.offsetWidth,this.viewport.style.height=window.visualViewport.height+"px",this.pages_container.style.width=this.nr_pages*this.viewport_width+"px",this.pages_container.style.left=-this.current_page_idx*this.viewport.offsetWidth+"px",this.lst_pages.forEach(t=>t.style.width=this.viewport_width+"px"),this.f50(),this.f59(),null!==this.client_onResize&&this.client_onResize(this.viewport_width,this.viewport.offsetHeight)},f22:function(){return this.viewport_width},f17:function(){return this.viewport.offsetHeight},f51:function(t=""){if("string"==typeof t){var s=0,e=t;for(t=this.current_page_idx;s<this.nr_pages;){if(this.lst_pages[s].id===e){t=s;break}s++}}return this.pages_container.style.left=-t*this.viewport.offsetWidth+"px",this.previous_page_idx=this.current_page_idx,this.current_page_idx=t},f15:function(){return this.current_page_idx},f16:function(){return this.lst_pages[this.current_page_idx].id},f50:function(){this.f51(this.current_page_idx)},f52:function(){this.f51(this.current_page_idx)},f47:function(t,s){this.page_mode=t,this.page_rotate_id=s,this.f59()},f59:function(){this.show_page=!1,this.page_mode!==this.PAGE_FREE&&(Math.sign(this.viewport.offsetWidth-this.viewport.offsetHeight)!==this.page_mode?(-1===this.page_before_rotate&&(this.page_before_rotate=this.current_page_idx),this.f51(this.page_rotate_id),this.show_page=!0):-1!==this.page_before_rotate&&(this.f51(this.page_before_rotate),this.page_before_rotate=-1,this.show_page=!0)),this.show_page||this.f50()},f1:function(t,s,e){"MOUSE||TOUCH"===s&&(s=this.mouse_or_touch),t.addEventListener(s,e)},A1:{}};A0.A1.f66=function(){return 0<navigator.maxTouchPoints},A0.A1.f71=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},A0.A2={prefix:null,obj:null},A0.A2.f24=function(t){this.prefix=t,this.obj=window.localStorage},A0.A2.f6=function(){},A0.A2.f44=function(t){this.obj.removeItem(this.prefix+"_"+t)},A0.A2.f46=function(t,s){this.obj.setItem(this.prefix+"_"+t,JSON.stringify(s))},A0.A2.f18=function(t){return JSON.parse(this.obj.getItem(this.prefix+"_"+t))},A0.A2.f39=function(t,s){var e=this.f18(t);if(null===e)this.f46(t,s);else for(var i in e)s.hasOwnProperty(i)&&(s[i]=e[i]);return null!==e};class CardPile extends FlexBox{constructor(t){super(t,"column","center","center",!0),this.id=t,this.lst_cards=[],this.delay=0,this.top_card_face=!1,this.base=new FlexBoxEntity(this.id+"_Base",!0);t=this.base.m13();t.classList.add("CardPileBase"),t.classList.add("Clickable"),A0.f1(t,"MOUSE||TOUCH",this.onClickBase.bind(this)),t.addEventListener("contextmenu",A3.f80.bind(A3)),this.m3(this.base,!0,!0),this.e_counter=document.createElement("p"),this.e_counter.classList.add("Hidden"),t.appendChild(this.e_counter)}m8(){return this.lst_cards}m66(t){this.top_card_face=t,0<this.lst_cards.length&&this.lst_cards[this.lst_cards.length-1].m58(t)}f81(t,s,e,i,n,r){super.f81(t,s,e,i),this.m57(n,r),this.m56(),this.m53(),this.e_counter.style.fontSize=Math.round(.09*t)+"px"}onClickBase(t){t.stopPropagation(),t.preventDefault(),A3.f76(this)}m53(){const[s,e]=this.base.m20();this.lst_cards.forEach(t=>t.m61(s,e))}m52(){var s=1;this.lst_cards.forEach(t=>t.m67(s++))}m55(t){this.delay=t}f0(t,s=!0){var e;this.lst_cards.includes(t)||(this.lst_cards[s?"push":"unshift"](t),this.e_counter.innerHTML=this.lst_cards.length,t.m60(this),[s,e]=this.base.m20(),t.m61(s,e),t.m58(!1),k2(this.delay,t).then(t=>{this.m52(),this.m28()}))}m7(){var t;return 0===this.lst_cards.length?null:((t=this.lst_cards.pop()).m67(1+this.lst_cards.length),t.m59(!1),this.m28(),this.e_counter.innerHTML=this.lst_cards.length,A3.f37(this,this.lst_cards.length),t)}m2(t){this.f0(t,!0)}m1(t){this.f0(t,!1)}m28(){var t=this.lst_cards.length-1;if(0<=t){var s=this.lst_cards[t];for(s.m59(!1),s.m58(this.top_card_face),--t;0<=t;--t)(s=this.lst_cards[t]).m59(!0),s.m58(!1)}}_TopCard(){return this.lst_cards[this.lst_cards.length-1]}m32(){return 0===this.lst_cards.length}m19(){return this.lst_cards.length}m47(t){this.lst_cards.includes(t)&&(k6(this.lst_cards,t),t.m59(!1),this.e_counter.innerHTML=this.lst_cards.length,this.m28())}m68(t){this.e_counter.classList[t?"remove":"add"]("Hidden"),t&&(this.e_counter.innerHTML=this.lst_cards.length)}}class Deck{constructor(t){this.lst_cards=[],this.lst_cards_out=[],this.nr_jokers=t,this.m42(t)}m42(t){for(var s,e,i,n=0,r=[],a=0;a<4;++a)for(i=this.m24(a),r.includes(i)||r.push(i),s=1;s<=13;++s)e=new Card(n++,{value:a,symbol:this.m25(a),color:i},{value:s,symbol:this.m27(s)}),this.lst_cards.push(e);for(var h=0,l=1;l<=t;++l)e=new Card(n++,{value:SUIT_JOKER,symbol:this.m25(SUIT_JOKER),color:r[h]},{value:ROYAL_JOKER,symbol:this.m27(s)}),this.lst_cards.push(e),h=(1+h)%r.length}f81(s){const e=Math.round(s/CARD_ASPECT_RATIO);return this.m4(t=>{null!==t&&t.m64(e,s)}),e}m4(t){this.lst_cards.forEach(t),this.lst_cards_out.forEach(t)}m70(){k9(this.lst_cards)}f13(){var t;return 0===this.lst_cards.length?null:(t=k8(this.lst_cards),this.lst_cards_out.push(t),t)}m21(){var t;return 0===this.lst_cards.length||0===(t=this.lst_cards.filter(t=>t.m39())).length?null:(t=k3(t),k6(this.lst_cards,t),this.lst_cards_out.push(t),t)}m49(){for(;this.lst_cards_out.length;)this.lst_cards.push(this.lst_cards_out.pop())}m25(s){return LST_SUITS.filter(t=>t.id===s).pop().symbol}m24(s){return LST_SUITS.filter(t=>t.id===s).pop().color}m27(s){return 1===s||11<=s&&s<=14?LST_ROYALS.filter(t=>t.value===s).pop().symbol:s}m15(t,s){return t.f21()+s.f21()}}class Dungeon extends FlexBox{constructor(){super("Dungeon","row","evenly","center",!0),this.lst_columns=[],this.lst_columns_hidden=[];for(var t,s=0;s<NR_DUNGOEN_COLUMNS;++s)t=new DungeonColumn(s),this.lst_columns.push(t),this.m3(t,!0,!0),A3.f3(t.m13())}m8(){var s=[];return this.lst_columns.forEach(t=>s=s.concat(t.m8())),this.lst_columns_hidden.forEach(t=>s=s.concat(t.m8())),s}m50(){for(var t;t=this.lst_columns_hidden.pop();)t.m59(!1),this.m3(t,!0,!0),A3.f3(t.m13())}m29(t){t=this.m10(t);t.m59(!0),this.lst_columns_hidden.push(t),this.m48(t,!0,!0),A3.f43(t.m13())}f81(t,s,e,i){super.f81(t,s,e,i),this.m57(Math.round(t/4*.9),s),this.m56()}m10(s){return this.lst_columns.filter(t=>t.m16()===s).pop()}m5(t,s){return this.m10(t).m5(s)}m22(t){return this.m5(t,ROYALS_AREA_ID)}m14(t){return this.m5(t,FIGHTERS_AREA_ID)}m46(){var s=0,e=0;return this.lst_columns.forEach(t=>{t.m45()&&(s+=1),t.m37()||(e+=1)}),s===e}}class DungeonColumn extends FlexBox{constructor(t){var s;super("DungeonColumn_"+t,"column","center","center",!0),this.id=t,this.element.classList.add("DungeonColumn"),this.hidden=!1,this.lst_areas=[];for(const e of[ROYALS_AREA_ID,FIGHTERS_AREA_ID])s=new DungeonColumnArea(e,t),e===ROYALS_AREA_ID&&s.m54(ROYALS_CONDENSE),this.lst_areas.push(s),this.m3(s,!0,!0),A3.f3(s.m13())}m8(){var s=[];return this.lst_areas.forEach(t=>s=s.concat(t.m8())),s}m16(){return this.id}m64(t,s){super.m64(t,s);var e=ROYALS_HEIGHT/(ROYALS_HEIGHT+3),i=3/(ROYALS_HEIGHT+3);this.lst_areas[0].m64(t,Math.floor(s*e)),this.lst_areas[1].m64(t,Math.floor(s*i))}m5(t){return this.lst_areas[t]}m0(t,s){this.lst_areas[s].f0(t)}m37(){return this.hidden}m59(s){this.hidden=s,this.element.classList[s?"add":"remove"]("Hidden"),this.lst_areas.forEach(t=>t.m59(s))}m45(){return this.lst_areas[FIGHTERS_AREA_ID].m36()&&1===this.lst_areas[ROYALS_AREA_ID].m19()}}class DungeonColumnArea extends FlexBox{constructor(t,s){super(["DungeonColumnArea",s,t].join("_"),"column",0===t?"end":"start","center",!0),this.id=t,this.column_id=s,this.element.classList.add("DungeonColumnArea"),this.element.classList.add("DungeonColumnArea"+(t===ROYALS_AREA_ID?"Royal":"Fighter")),t===FIGHTERS_AREA_ID?(this.element.classList.add("Clickable"),this.element.classList.add("FightersArea"),A0.f1(this.element,"MOUSE||TOUCH",this.onClick.bind(this)),this.element.addEventListener("contextmenu",A3.f80.bind(A3))):this.element.classList.add("RoyalsArea"),this.lst_cards=[],this.MAX_CARDS=this.id===ROYALS_AREA_ID?MAX_CARDS_ROYALS:MAX_CARDS_ATTACK}m8(){return this.lst_cards}f0(t){this.lst_cards.length===this.MAX_CARDS||this.lst_cards.includes(t)||(this.lst_cards.push(t),t.m65(!0),t.m58(this.id===FIGHTERS_AREA_ID||this.lst_cards.length===MAX_CARDS_ROYALS),t.m60(this),t.m67(this.lst_cards.length),this.m3(t,!1,!0))}m47(t){this.lst_cards.includes(t)&&(k6(this.lst_cards,t),this.m48(t,!1,!0),this.id===ROYALS_AREA_ID)&&1===this.lst_cards.length&&this.lst_cards[0].m58(!0)}onClick(t){t.stopPropagation(),t.preventDefault(),A3.f74(this)}m16(){return this.id}m11(){return this.column_id}m19(){return this.lst_cards.length}m32(){return 0===this.lst_cards.length}m36(){return this.lst_cards.length===this.MAX_CARDS}m35(){return this.id===FIGHTERS_AREA_ID}m6(){return this.m35()?this.lst_cards.slice(0,2):null}f13(t){return!this.m35()||this.lst_cards.length<=t?null:this.lst_cards[t]}m26(){return!this.m35()||this.lst_cards.length!==MAX_CARDS_ATTACK?null:this.lst_cards[MAX_CARDS_ATTACK-1]}m51(t){if(this.m35())return null;this.element.classList[t?"add":"remove"]("Attackable")}m12(){return this.m35()||this.lst_cards.length<1?null:this.lst_cards[this.lst_cards.length-1]}m18(){return this.m35()||this.lst_cards.length<=1?null:this.lst_cards[this.lst_cards.length-2]}m59(t){this.element.classList[t?"add":"remove"]("Hidden")}}class Hand extends FlexBox{constructor(){super("Hand","row","evenly","center",!0),this.lst_cards=[],this.element.classList.add("Clickable"),A0.f1(this.element,"MOUSE||TOUCH",this.onClick.bind(this)),this.element.addEventListener("contextmenu",A3.f80.bind(A3))}f81(t,s,e,i){super.f81(t,s,e,i),this.m56()}m8(){return this.lst_cards}f0(t){this.lst_cards.length===MAX_CARDS_HAND||this.lst_cards.includes(t)||(t.m65(!0),t.m60(this),t.m58(!0),t.m67(100+this.lst_cards.length),this.lst_cards.push(t),this.m3(t,!1,!0))}m47(t){this.lst_cards.includes(t)&&(k6(this.lst_cards,t),this.m48(t,!1,!0))}onClick(t){t.stopPropagation(),t.preventDefault(),A3.f77(this)}m32(){return 0===this.lst_cards.length}m36(){return this.lst_cards.length===MAX_CARDS_HAND}}class Messenger{constructor(t){this.element=document.createElement("div"),this.element.id="Messenger",this.txt=document.createElement("p"),this.element.appendChild(this.txt),this.show_time=t,this.timer=null}m63(t){this.show_time=t}m13(){return this.element}f81(t,s,e,i){this.element.style.width=t+"px",this.element.style.height=s+"px",this.element.style.left=i+"px",this.txt.style.fontSize=Math.min(Math.round(.25*s),17)+"px",this.f23()}f23(){this.element.style.top=-1.1*this.element.offsetHeight+"px"}f49(t,s){0<this.show_time&&(clearTimeout(this.timer),this.timer=setTimeout(this.f23.bind(this),this.show_time),this.txt.innerHTML="<span>"+t+"</span>: "+s,this.element.style.top=0)}m69(t){clearTimeout(this.timer),this.txt.innerHTML=t,this.element.style.top=0}}const DUNGEON_HAND_SPACING=.25,ROYALS_CONDENSE=.75,DUNGEON_WIDTH=.8,CARD_ASPECT_RATIO=16/11,DISTRIBUTE_ROYALS_SPEED=.2,DISTRIBUTE_HAND_SPEED=.2,DISTRIBUTE_KILL_SPEED=.5,_MAX_CARDS_AREA=3,NR_ROYALS=12,MAX_CARDS_ATTACK=3;var NR_DUNGOEN_COLUMNS=0,MAX_CARDS_ROYALS=0,ROYALS_HEIGHT=0,TOTAL_HEIGHT=0,DUNGEON_HEIGHT=0;const CARD_TRANSLATION_TIME=500,ROYALS_AREA_ID=0,FIGHTERS_AREA_ID=1,MAX_CARDS_HAND=3,SUIT_HEARTS=0,SUIT_SPADES=1,SUIT_DIAMONDS=2,SUIT_CLUBS=3,SUIT_JOKER=4;var ROYAL_JACK=11,ROYAL_QUEEN=12;const ROYAL_KING=13,ROYAL_JOKER=14,JOKER_MIN=2,JOKER_MAX=10,LST_SUITS_0=[{id:SUIT_HEARTS,symbol:"&hearts;",color:"Red"},{id:SUIT_SPADES,symbol:"&spades;",color:"Black"},{id:SUIT_DIAMONDS,symbol:"&diams;",color:"Red"},{id:SUIT_CLUBS,symbol:"&clubs;",color:"Black"},{id:SUIT_JOKER,symbol:"",color:""}],LST_ROYALS_0=[{value:"J",symbol:"J"},{value:"Q",symbol:"Q"},{value:ROYAL_KING,symbol:"K"},{value:ROYAL_JOKER,symbol:"&#x2605;"},{value:1,symbol:"A"}],LST_SUITS_1=[{id:SUIT_HEARTS,symbol:"&#x25B2;",color:"Red"},{id:SUIT_SPADES,symbol:"&#x25B2;",color:"Black"},{id:SUIT_DIAMONDS,symbol:"&#x25FC;",color:"Red"},{id:SUIT_CLUBS,symbol:"&#x25FC;",color:"Black"},{id:SUIT_JOKER,symbol:"",color:""}],LST_ROYALS_1=[{value:"J",symbol:"&#x268A;"},{value:"Q",symbol:"&#x268C;"},{value:ROYAL_KING,symbol:"&#x2630;"},{value:ROYAL_JOKER,symbol:"&#x25C9;"},{value:1,symbol:"1"}],LST_ROYALS_ALL=[LST_ROYALS_0,LST_ROYALS_1],LST_SUITS_ALL=[LST_SUITS_0,LST_SUITS_1];var LST_ROYALS=null,LST_SUITS=null;const A3={viewport:null,spacing:0,dungeon:null,hand:null,deck:null,draw_pile:null,discard_royals:null,discard_fighters:null,discard_graveyard:null,card_height:0,clicked_card:null,selected_card:null,in_game_stats:null,messenger:null,busy:!1};function k13(t){return document.getElementById(t)}function k14(t,s){return(s=s||document).getElementsByTagName(t)[0]}function k11(t,s){return(s=s||document).getElementsByTagName(t)}function k12(t,s=document){return s.querySelector(t)}function k10(t,s=document){return s.querySelectorAll(t)}function k15(t,s){for(s=s.toUpperCase();t.tagName!==s;)t=t.parentNode;return t}function k2(e,i=null){return new Promise((t,s)=>setTimeout(t,e,i))}function k5(t,s=null,e=null,i=null){t=new URL(window.location).searchParams.get(t);return null===t||(null!==e&&"string"!==e&&("int"===e?t=n(t=parseInt(t,10),i):"float"===e?t=n(t=parseFloat(t,10),i):"boolean"===e?t=Boolean(parseInt(t,10)):"uppercase"===e?t=t.toUpperCase():"lowercase"===e&&(t=t.toLowerCase())),["string","uppercase","lowercase"].includes(e)&&null!==i&&!i.includes(t))?s:t;function n(t,s){var e;return null!==s&&(e=s[0],s=s[1],t<e?t=e:s<t&&(t=s)),t}}function k9(t){for(var s=t.length-1;0<s;s--){var e=Math.floor(Math.random()*(s+1)),i=t[s];t[s]=t[e],t[e]=i}}function k1(t){return t.slice(0)}function k6(t,s){return t.includes(s)?t.splice(t.indexOf(s),1).pop():null}function k7(t,s){return s>=t.length?null:t.splice(s,1).pop()}function k8(t){return k7(t,Math.f82(0,t.length-1))}function k3(t){return t[Math.f82(0,t.length-1)]}A3.f24=function(){A0.f24(this.f81.bind(this)),A0.f47(A0.PAGE_LANDSCAPE,"Rotate"),A0.A2.f24("CTD"),this.viewport=k13("GameViewport"),this.in_game_stats=k13("InGameStats"),this.A6.f24(),this.A5.f24(),this.A5.f23(),this.deck=new Deck(this.A6.f21("nr_jokers")),this.dungeon=new Dungeon,this.hand=new Hand,this.draw_pile=new CardPile("DrawPile"),this.discard_royals=new CardPile("DiscardRoyals"),this.discard_fighters=new CardPile("DiscardFighters"),this.discard_graveyard=new CardPile("DiscardGraveyard"),this.messenger=new Messenger(1e3*this.A6.f21("warn_time")),document.body.appendChild(this.messenger.m13()),this.A6.f21("reuse_discard")?this.discard_fighters.m66(!0):k13("stats_reused").style.display="none",this.discard_fighters.m55(CARD_TRANSLATION_TIME),this.discard_royals.m55(CARD_TRANSLATION_TIME),this.discard_graveyard.m55(CARD_TRANSLATION_TIME),A0.f81(),k13("AppViewport").classList.remove("AppInit"),A0.f1(window,"contextmenu",this.f80.bind(this)),A0.f1(window,"MOUSE||TOUCH",this.f45.bind(this)),A0.f1(k13("HomeCard"),"MOUSE||TOUCH",this.f78.bind(this)),this.f40();var t=k5("goto","");"Play"===t?this.f78(null):""!==t&&A0.f51(t)},A3.f78=function(t){A0.f51("Play"),k13("MenuIcon").classList.remove("Hidden"),A3.A5.f49()},A3.f3=function(t){this.viewport.appendChild(t)},A3.f43=function(t){t.remove()},A3.f81=function(t,s){this.spacing=this.viewport.offsetTop;var t=Math.min(t-2*this.spacing,1.15*s),s=(this.viewport.style.width=Math.round(t)+"px",this.viewport.style.height=Math.round(window.visualViewport.height-2*this.spacing)+"px",this.A5.f29()||this.A5.f23(),Math.round(this.viewport.offsetWidth*DUNGEON_WIDTH)),t=Math.round(this.viewport.offsetHeight*DUNGEON_HEIGHT),e=(this.card_height=Math.round(this.viewport.offsetHeight*(1/TOTAL_HEIGHT)),this.deck.f81(this.card_height)),i=(this.dungeon.f81(s,t,0,0),this.hand.f81(s,this.card_height,t+this.card_height*DUNGEON_HAND_SPACING,0),this.viewport.offsetWidth-s-this.spacing),n=this.card_height,r=s+this.spacing,t=(this.draw_pile.f81(i,n,t+this.card_height*DUNGEON_HAND_SPACING,r,e,this.card_height),ROYALS_HEIGHT*this.card_height);this.discard_royals.f81(i,n,t,r,e,this.card_height),this.discard_graveyard.f81(i,n,t+ +this.card_height,r,e,this.card_height),this.discard_fighters.f81(i,n,t+2*this.card_height,r,e,this.card_height),this.in_game_stats.style.height=Math.round(ROYALS_HEIGHT*this.card_height-this.spacing)+"px",this.in_game_stats.style.width=i+"px",this.in_game_stats.style.fontSize=Math.round(.09*i)+"px",this.messenger.f81(s,(ROYALS_HEIGHT-1)*this.card_height,0,this.viewport.offsetLeft)},A3.f14=function(){return this.card_height},A3.f53=function(){this.busy||(this.busy=!0,k13("Menu_Play").classList.add("Hidden"),this.f45(),this.messenger.f23(),this.deck.m49(),this.deck.m70(),this.A7.f6(),this.A7.f55(),this.dungeon.m50(),this.f9().then(t=>this.f41()).then(t=>this.f11(DISTRIBUTE_ROYALS_SPEED)).then(t=>this.f10(DISTRIBUTE_HAND_SPEED)).then(t=>{this.draw_pile.m55(CARD_TRANSLATION_TIME),this.draw_pile.m68(!0),this.discard_fighters.m68(!0),this.A7.f54(),k13("Menu_Play").classList.remove("Hidden"),this.busy=!1}))},A3.f41=function(){for(;card=this.deck.m21();)this.f36(card,this.draw_pile,1);for(;card=this.deck.f13();)this.f36(card,this.draw_pile,-1);return Promise.resolve(null)},A3.f11=function(t=DISTRIBUTE_ROYALS_SPEED){for(var e=[],s=0;s<NR_DUNGOEN_COLUMNS;++s)for(var i=1;i<=MAX_CARDS_ROYALS;++i)e.push(s);k9(e);for(var n=[],r=0,a=CARD_TRANSLATION_TIME*t,i=NR_ROYALS;0<i--;)n.push(k2(r).then(t=>{var s=A3.draw_pile.m7();A3.dungeon.m5(e.pop(),0).f0(s)})),r+=a;return n.push(k2(3*CARD_TRANSLATION_TIME)),Promise.all(n)},A3.f10=function(t=DISTRIBUTE_HAND_SPEED){this.A4.f6();for(var s=[],e=0,i=CARD_TRANSLATION_TIME*t,n=Math.min(MAX_CARDS_HAND,this.draw_pile.m19());0<n--;)s.push(k2(e).then(t=>{var s=A3.draw_pile.m7();A3.hand.f0(s)})),e+=i;return s.push(k2(e)),Promise.all(s)},A3.f75=function(t){if(this.f45(),(this.clicked_card=t).m33())return t.m31(this.discard_fighters)&&this.f56()?void 0:void this.f70("Card","I'm face down, let me be.");var s=t.m17();s instanceof DungeonColumnArea&&s.m35()?this.f70("Attack card","Undo? Click your hand area. Attack? Click the royal."):s===this.discard_fighters&&null!==this.selected_card&&t!==this.selected_card?this.f56():t.m71()?(null!==this.selected_card&&this.selected_card.m62(!1),(this.selected_card=t).m39()&&(this.f7(),this.f57(t))&&(this.A7.f2("nr_attacks",1),this.f58(!0)),this.selected_card):this.selected_card=null},A3.f7=function(){this.selected_card instanceof Card&&this.selected_card.m62(!1),this.selected_card=null},A3.f74=function(t){this.f45();var s=this.dungeon.m22(t.m11());if(!s.m32())if(null===this.selected_card)t.m36()?this.f70("Prepare attack","I'm ready, click the royal card."):this.f70("Prepare attack","Select a card and play it here.");else{var e=this.selected_card.m17();if(e===this.hand||e===this.discard_fighters&&!this.selected_card.m33()){var i=s.m12();if(t.m19()<MAX_CARDS_ATTACK-1){if(!this.f69(i))return this.f7(),!1}else{if(!this.f60(this.selected_card,i))return this.f7(),!1;s.m51(!0)}e===this.discard_fighters?(this.A4.f42([this.selected_card]),this.A4.f42(t.m6()),this.A7.f2("reused",1)):this.A4.f0(this.selected_card),this.f36(this.selected_card,t),this.hand.m32()&&k2(CARD_TRANSLATION_TIME).then(t=>A3.f10()).then(t=>{A3.f58()})}}},A3.f58=function(t=!1){var s=0;t?this.A7.f19("nr_attacks")===NR_ROYALS&&(s=1):(this.dungeon.m46(),this.hand.m32()&&!this.dungeon.m46()&&(s=-1)),0!==s&&(this.A7.f55(),this.messenger.m69(1===s?"Congratulations! Up to another?":"Almost there... Try again!"))},A3.f77=function(t){var s,e;this.f45(),t.m36()?this.f70("Undo","Hand is full."):(s=this.A4.f13())instanceof Card?((e=s.m17())!==this.discard_fighters&&this.dungeon.m22(e.m11()).m51(!1),this.f36(s,t)):this.f70("Undo","Sorry, no card available.")},A3.f76=function(t){this.f45(),t!==this.discard_fighters?t===this.discard_royals?this.f70("Discard royals","I can manage myself, thanks."):t===this.discard_graveyard?this.f70("Graveyard","I can manage myself, thanks."):t===this.draw_pile&&this.f70("Draw pile","I can manage myself, thanks."):null===this.selected_card?this.f70("Discard fighters","Select a card from your hand."):this.f56()},A3.f56=function(){var t=this.selected_card;return null!==t&&!!t.m31(this.hand)&&(this.A4.f0(t),this.f8(t),this.hand.m32()&&k2(CARD_TRANSLATION_TIME).then(t=>A3.f10()).then(t=>{A3.f58()}),!0)},A3.f36=function(t,s,e=0){s instanceof FlexBox&&t instanceof Card&&(t.m17().m47(t),s===this.discard_fighters?s.m1(t):0===e?s.f0(t):1===e?s.m2(t):-1===e&&s.m1(t),this.f7())},A3.f57=function(t){var s,e,i,n=this.dungeon.m14(t.m17().m11());return n.m36()?(s=n.m26(),!(!this.f60(s,t)||([n,e]=n.m6(),(i=this.deck.m15(n,e))<t.f21())||(n.m38()||n.m38()||(i=i-t.f21(),this.A7.f2("overkill",i)),this.f12([t,n,e,s]),0))):(this.f70("Start attack","Place two attack cards and a trigger card."),!1)},A3.f63=function(t,s){return!this.A6.f21("joker_trigger_color")||t.m9()===s.m9()||(this.f70("Prepare attack","Trigger joker must match color."),!1)},A3.f62=function(t,s,e=!1){e=e?"ace_":"";if(this.A6.f21(e+"trigger_suit")){if(t.m23()!==s.m23())return this.f70("Prepare attack","Trigger card must match suit."),!1}else if(this.A6.f21(e+"trigger_color")&&t.m9()!==s.m9())return this.f70("Prepare attack","Trigger card must match color."),!1;e=this.A6.f21(e+"trigger_value");if("any"!==e){var[i,n]=this.dungeon.m14(s.m17().m11()).m6(),s=this.f20(s.f21(),i,n),i=t.f21();if("ge"===e){if(i<s)return this.f70("Prepare attack","Trigger card must be &ge; "+s+"."),!1}else if(i<=s)return this.f70("Prepare attack","Trigger card must be &gt; "+s+"."),!1}return!0},A3.f61=function(t,s){return this.f62(t,s,!0)},A3.f60=function(t,s){return t.m38()?this.f63(t,s):t.m30()?this.f61(t,s):this.f62(t,s)},A3.f20=function(t,s,e){var i=e.f21();return s.m38()?t-i:(s=s.f21(),e.m38()?t-s:Math.min(s,i))},A3.f69=function(t){var s,e=this.dungeon.m14(t.m17().m11()),i=e.f13(0);if(null===i?(i=this.selected_card,s=null):null===(s=e.f13(1))&&(s=this.selected_card),this.A6.f21("joker_attack_color")){var e=t.m9(),n=!0;if(null!==i&&i.m38()&&i.m9()!==e&&(n=!1),!(n=null!==s&&s.m38()&&s.m9()!==e?!1:n))return this.f70("Prepare attack","Attack joker must match color"),!1}e=null===i?0:i.f21(),n=null===s?0:s.f21(),i=t.f21();return 0===n?i<=e+10||(this.f70("Prepare attack",[i,"-",e,"&gt;",10].join(" ")),!1):i<=e+n||(this.f70("Prepare attack",[e,"+",n,"&lt;",i].join(" ")),!1)},A3.f12=function(t){const[s,e,i,n]=t;for(var r=[],a=0,h=CARD_TRANSLATION_TIME*DISTRIBUTE_KILL_SPEED,l=3;0<=l;)r.push(k2(a,t[l--]).then(t=>{t.m67(100+l),this.f8(t,!0)})),a+=h;r.push(k2(a));const o=this.dungeon.m14(n.m17().m11()),d=this.dungeon.m22(n.m17().m11()),c=s.m17().m18();Promise.all(r).then(t=>{d.m51(!1),this.A4.f42([e,i,n]),null!==c?c.m58(!0):this.dungeon.m29(o.m11())})},A3.f70=function(t,s){this.messenger.f49(t,s)},A3.f37=function(t,s){t===this.draw_pile&&s<=this.A6.f21("warn_draw_level")&&this.f70("Draw pile",s+" left.")},A3.f80=function(t){this.f45(),t.stopPropagation(),t.preventDefault(),t.target.click()},A3.f45=function(){A0.A1.f66()&&!A0.A1.f71()&&document.body.requestFullscreen&&document.body.requestFullscreen()},A3.f8=function(t,s=!1){t instanceof Card&&(t===this.selected_card&&this.f7(),t.m67(100),this.f36(t,t.m39()?this.discard_royals:s?this.discard_graveyard:this.discard_fighters))},A3.f9=function(){var t=[];t=(t=(t=(t=t.concat(this.discard_fighters.m8())).concat(this.hand.m8())).concat(this.dungeon.m8())).concat(this.draw_pile.m8());const e=CARD_TRANSLATION_TIME*DISTRIBUTE_ROYALS_SPEED;var i=[],n=0;return t.forEach(s=>{i.push(k2(n).then(t=>{this.f8(s,!0)})),n+=e}),i.push(k2(n+CARD_TRANSLATION_TIME)),Promise.all(i)},A3.f40=function(){for(var t;t=this.deck.f13();)(t.m39()?this.discard_royals:this.discard_graveyard).f0(t)},A3.A4={lst:[]},A3.A4.f6=function(){for(;this.lst.pop(););},A3.A4.f0=function(t){this.lst.includes(t),this.lst.push(t)},A3.A4.f13=function(){return 0===this.lst.length?null:this.lst.pop()},A3.A4.f42=function(t){0!==this.lst.length&&t.forEach(t=>{k6(this.lst,t)})},A3.A5={menu_pannel:null},A3.A5.f24=function(){this.menu_pannel=k13("MenuPannel"),A0.f1(k13("MenuIcon"),"MOUSE||TOUCH",A3.A5.f65.bind(A3.A5)),Array.from(k11("p",this.menu_pannel)).forEach(t=>{t.classList.add("Clickable"),A0.f1(t,"MOUSE||TOUCH",this.f79.bind(this))})},A3.A5.f79=function(t){t=t.target.id.split("_").pop();"Home"===t?(k13("MenuIcon").classList.add("Hidden"),A3.A5.f65()):"Play"===t?"Play"===A0.f16()&&A3.f53():"Options"===t&&k13("OptionsApply").classList.add("Hidden"),A0.f51(t)},A3.A5.f49=function(){this.menu_pannel.style.right=0},A3.A5.f29=function(){return this.menu_pannel.style.right.length<=3},A3.A5.f23=function(){this.menu_pannel.style.right=-this.menu_pannel.offsetWidth+"px"},A3.A5.f65=function(t){this.f29()?this.f23():this.f49()},A3.A6={key:"options",data:{cards:{type:"int",value:0,values:[0,1],labels:["Default","Abstract"],restart:2},reuse_discard:{type:"boolean",value:!1,restart:2},royals_sequence:{type:"string",value:"JQK",values:["JQK","QJK"],restart:2},nr_jokers:{type:"int",value:2,values:[0,1,2,3,4],restart:2},show_royals_value:{type:"boolean",value:!0,restart:2},nr_columns:{type:"int",value:3,values:[3,4],restart:2},warn_time:{type:"int",value:4,values:[0,3,4,5],restart:0},warn_draw_level:{type:"int",value:6,values:[0,3,6,9],restart:0},trigger_suit:{type:"boolean",value:!0,restart:0},ace_trigger_suit:{type:"boolean",value:!0,restart:0},trigger_color:{type:"boolean",value:!0,restart:0},ace_trigger_color:{type:"boolean",value:!0,restart:0},trigger_value:{type:"string",value:"any",values:["any","ge","gt"],labels:["Unrelated","&ge;","&gt;"],restart:0},ace_trigger_value:{type:"string",value:"any",values:["any","ge","gt"],labels:["Unrelated","&ge;","&gt;"],restart:0},joker_trigger_color:{type:"boolean",value:!1,restart:0},joker_attack_color:{type:"boolean",value:!1,restart:0}}},A3.A6.f35=function(){var t,s={};for(t in this.data)s[t]=this.data[t].value;return s},A3.A6.f68=function(){A0.A2.f46(this.key,this.f35())},A3.A6.f67=function(t){for(var s in t)this.data[s].value=t[s]},A3.A6.f24=function(){var t=this.f35();A0.A2.f39(this.key,t)&&this.f67(t),1===this.data.cards.value&&(this.data.show_royals_value.value=!1,this.data.royals_sequence.value="JQK"),this.data.trigger_suit.value&&(this.data.trigger_color.value=!0),this.data.ace_trigger_suit.value&&(this.data.ace_trigger_color.value=!0);this.data;this.f26(),k13("stats_reused").style.display=this.data.reuse_discard.value?"":"none",this.f25(),this.f28()},A3.A6.f26=function(){var t,s,e=k14("div",k13("Options"));for(t in this.data)(s=document.createElement("p")).classList.add("OptionsParagraph"),this.f34(t,s),e.appendChild(s);var i=k13("OptionsApply");i.classList.add("Hidden"),A0.f1(i,"MOUSE||TOUCH",this.f4.bind(this))},A3.A6.f4=function(t){t.preventDefault(),t.stopPropagation();t=self.location.protocol+"//"+self.location.host+self.location.pathname;self.location=t+"?goto=Play"},A3.A6.f21=function(t){return this.data[t].value},A3.A6.f34=function(t,s){var e,i,n,r,a,h=this.data[t],l=document.createElement("span"),o=(l.classList.add("Restart_"+h.restart),l.innerHTML=t,s.appendChild(l),"boolean"===h.type?(e=["Yes","No"],a=!0):(a=!1,e=h.values),0);for(i of e)(n=document.createElement("input")).type="radio",n.id=t+"_"+i,n.name=t,n.value=a?"Yes"===i?1:0:i,n.checked=(a?"Yes"===i:i)===this.data[t].value,n.addEventListener("change",this.f73.bind(this)),(r=document.createElement("label")).for=n.id,void 0!==h.labels?r.innerHTML=h.labels[o]:r.innerHTML=i,s.appendChild(n),s.appendChild(r),++o},A3.A6.f73=function(t){var t=t.target,s=t.name,e=t.value;"int"===this.data[s].type?e=parseInt(e,10):"boolean"===this.data[s].type&&(e="1"===e),"warn_time"===s&&A3.messenger.m63(1e3*e),this.data[t.name].value=e,this.f68(),2===this.data[s].restart&&k13("OptionsApply").classList.remove("Hidden")},A3.A6.f25=function(){NR_DUNGOEN_COLUMNS=this.data.nr_columns.value,MAX_CARDS_ROYALS=NR_ROYALS/NR_DUNGOEN_COLUMNS,ROYALS_HEIGHT=MAX_CARDS_ROYALS-(MAX_CARDS_ROYALS-1)*ROYALS_CONDENSE,TOTAL_HEIGHT=ROYALS_HEIGHT+MAX_CARDS_ATTACK+DUNGEON_HAND_SPACING+1,DUNGEON_HEIGHT=(ROYALS_HEIGHT+MAX_CARDS_ATTACK)/TOTAL_HEIGHT,LST_ROYALS=LST_ROYALS_ALL[this.data.cards.value],LST_SUITS=LST_SUITS_ALL[this.data.cards.value]},A3.A6.f28=function(){"QJK"===this.data.royals_sequence.value?(ROYAL_QUEEN=11,ROYAL_JACK=12):(ROYAL_JACK=11,ROYAL_QUEEN=12);for(var t of LST_ROYALS)"J"===t.value?t.value=ROYAL_JACK:"Q"===t.value&&(t.value=ROYAL_QUEEN)},A3.A7={keys:{reused:0,overkill:0,time:0,nr_attacks:0},timer:null},A3.A7.f2=function(t,s){this.keys[t]+=s;s=k13("txt_stats_"+t);return null!==s&&(s.innerHTML=this.keys[t]),this.keys[t]},A3.A7.f19=function(t){return this.keys[t]},A3.A7.f6=function(){this.keys.reused=0,this.keys.overkill=0,k13("txt_stats_reused").innerHTML=this.keys.reused,k13("txt_stats_overkill").innerHTML=this.keys.overkill,this.keys.time=0,this.keys.nr_attacks=0},A3.A7.f64=function(){this.f2("time",1),k13("txt_stats_time").innerHTML=this.keys.time,this.timer=setTimeout(this.f64.bind(this),1e3)},A3.A7.f54=function(){this.keys.time=0,k13("txt_stats_time").innerHTML=this.keys.time,this.timer=setTimeout(this.f64.bind(this),1e3)},A3.A7.f55=function(){clearTimeout(this.timer)},window.addEventListener("load",()=>{A3.f24()}),Math.f82=function(t,s){return Math.floor(Math.random()*(s-t+1))+t};