'use strict;'
class FlexBoxEntity{constructor(t,e=!1){this.id=t,this.top=1/0,this.left=1/0,this.width=1/0,this.height=1/0,this.element=e?this.MakeElement():null}MakeElement(){var t=document.createElement("div");return t.id=this.id,t.classList.add("FlexBoxEntity"),Game.AppendChild(t),t}GetId(){return this.id}GetElement(){return this.element}GetWidth(){return this.width}GetHeight(){return this.height}GetPosition(){return[this.top,this.left]}onResize(t,e,s,i){this.SetPosition(s,i),this.SetSize(t,e)}SetSize(t,e){this.width=t,this.height=e,null!==this.element&&(this.element.style.width=t+"px",this.element.style.height=e+"px")}SetPosition(t,e){this.top=t,this.left=e,null!==this.element&&(this.element.style.top=t+"px",this.element.style.left=e+"px")}}class FlexBox extends FlexBoxEntity{constructor(t,e,s,i,a=!1){super(t,a),a&&this.element.classList.add("FlexBox"),this.condense=0,this.lst_entities_ctrl_size=[],this.lst_entities_ctrl_position=[],this.orientation=e,this.justify=s,this.align=i}SetCondense(t){this.condense=t}onResize(t,e,s,i){super.onResize(t,e,s,i)}AddEntity(t,e,s,i=!0){i=i?"push":"unshift";e&&this.lst_entities_ctrl_size[i](t),s&&(this.lst_entities_ctrl_position[i](t),this.SetEntitiesPosition())}RemoveEntity(t,e,s){e&&RemoveArrayElement(this.lst_entities_ctrl_size,t),s&&(RemoveArrayElement(this.lst_entities_ctrl_position,t),this.SetEntitiesPosition())}SetEntitiesSize(e,s){0<this.lst_entities_ctrl_size.length&&this.lst_entities_ctrl_size.forEach(t=>t.SetSize(e,s))}SetPosition(t,e){super.SetPosition(t,e),this.SetEntitiesPosition()}SetEntitiesPosition(){var e,s,i,a;0<this.lst_entities_ctrl_position.length&&(s=e=0,this.lst_entities_ctrl_position.forEach(t=>{e+=t.GetWidth(),s+=t.GetHeight()}),"row"===this.orientation?(i=this["MakeDistributionList_"+this.justify](!0,"width",e),a=this["MakeDistributionList_"+this.align](!1,"height",s)):(a=this["MakeDistributionList_"+this.justify](!0,"height",s),i=this["MakeDistributionList_"+this.align](!1,"width",e)),this.lst_entities_ctrl_position.forEach(t=>{t.SetPosition(a.shift(),i.shift())}))}PrepareDistribuitonList(t,e){for(var s,i=this["width"===e?"left":"top"],a=[],r=0;r<this.lst_entities_ctrl_position.length;++r)t&&0<r&&(s=this.lst_entities_ctrl_position[r-1],i+="width"===e?s.GetWidth():s.GetHeight()),a.push(i);return a}MakeDistributionList_start(t,e,s){return this.PrepareDistribuitonList(t,e)}MakeDistributionList_center(t,e,s){for(var i,a=this.PrepareDistribuitonList(t,e),r=Math.round((this[e]-s)/2),n=0;n<this.lst_entities_ctrl_position.length;++n)t?a[n]+=r:(i=this.lst_entities_ctrl_position[n],a[n]+=Math.round((this[e]-("width"===e?i.GetWidth():i.GetHeight()))/2));return a}MakeDistributionList_end(t,e,s){for(var i,a,r=this.PrepareDistribuitonList(t,e),n=Math.round(this[e]-s),o=this.lst_entities_ctrl_position.length,l=0;l<o;++l)t?(r[l]+=n,this.condense&&l<o-1&&(i=this.lst_entities_ctrl_position[l],a="width"===e?i.GetWidth():i.GetHeight(),r[l]+=(o-1-l)*a*this.condense)):(i=this.lst_entities_ctrl_position[l],r[l]+=this[e]-("width"===e?i.GetWidth():i.GetHeight()));return r}MakeDistributionList_evenly(t,e,s){for(var i=this.PrepareDistribuitonList(t,e),a=this.lst_entities_ctrl_position.length,r=Math.round((this[e]-s)/(a+1)),n=0;n<a;++n)i[n]+=(n+1)*r;return i}}class Card extends FlexBoxEntity{constructor(t,e,s){super("Card_"+t,!0),this.id=t,this.suit=e.value,this.value=s.value,this.face_up=!1,this.selected=!1,this.location=null,this.e_body=null,this.e_face=null,this.e_back=null,this.e_value=null,this.e_suit=null,this.color=e.color,this.MakeBody(e.color),this.element.classList.add("Card"),this.element.classList.add("CardHidden"),this.e_body.classList.add("FaceDown"),(this.IsRoyal()||this.IsJoker())&&this.e_face.classList.add("CardRoyal"),this.e_suit.innerHTML=e.symbol,this.e_value.innerHTML=s.symbol,Game.Options.GetValue("show_royals_value")&&this.IsRoyal()&&(this.e_value.innerHTML+="<span>"+this.value+"<span>"),App.AddEventListener(this.e_body,"MOUSE||TOUCH",this.onClick.bind(this)),this.e_body.addEventListener("contextmenu",Game.onContextMenu.bind(Game))}onClick(t){t.stopPropagation(),t.preventDefault(),Game.onClickCard(this)}GetValue(){return this.value!==ROYAL_JOKER?this.value:JOKER_MAX}GetSuit(){return this.suit}GetColor(){return this.color}SetSize(t,e){super.SetSize(t,e),this.e_value.style.fontSize=Math.round(.3*t)+"px",this.e_value.children.length&&(this.e_value.children[0].style.fontSize=Math.round(.2*t)+"px"),this.e_suit.style.fontSize=Math.round(.4*t)+"px"}SetFaceUp(t){this.face_up=t,this.e_body.classList[t?"remove":"add"]("FaceDown")}SetSelected(t){this.selected=t,this.e_body.classList[t?"add":"remove"]("CardSelected")}ToggleSelected(){return this.SetSelected(!this.selected),this.selected}MakeBody(t){this.e_body=document.createElement("div"),this.e_body.classList.add("CardBody"),this.e_body.classList.add("Clickable"),this.element.appendChild(this.e_body),this.e_face=document.createElement("div"),this.e_face.classList.add("CardFace"),this.e_body.appendChild(this.e_face),this.e_back=document.createElement("div"),this.e_back.classList.add("CardBack"),this.e_body.appendChild(this.e_back),this.e_value=document.createElement("p"),this.e_value.classList.add("CardValue"),this.e_value.classList.add("CardValue"+t),this.e_face.appendChild(this.e_value),this.e_suit=document.createElement("p"),this.e_suit.classList.add("CardSuit"),this.e_suit.classList.add("CardSuit"+t),this.e_face.appendChild(this.e_suit)}SetLocation(t){this.location=t}IsAt(t){return this.location===t}GetLocation(){return this.location}IsRoyal(){return[ROYAL_JACK,ROYAL_QUEEN,ROYAL_KING].includes(this.value)}IsJoker(){return this.value===ROYAL_JOKER}IsAce(){return 1===this.value}IsFaceUp(){return this.face_up}IsFaceDown(){return!this.face_up}IsSelected(){return this.selected}SetHidden(t){this.element.classList[t?"add":"remove"]("CardHidden")}SetSmooth(t){this.element.classList[t?"add":"remove"]("CardSmooth")}SetZindex(t){this.element.style.zIndex=t}}window.addEventListener("error",t=>(alert("# ERROR: "+t.error.message+"\nUrl: "+t.error.fileName+"\nLine: "+t.error.lineNumber+"\n\n# Stack:\n\n"+t.error.stack+"\n"),!1));const App={viewport:null,viewport_width:0,pages_container:null,nr_pages:0,lst_pages:null,current_page_idx:0,previous_page_idx:0,client_onResize:null,mouse_or_touch:null,PAGE_FREE:0,PAGE_LANDSCAPE:1,PAGE_PORTRAIT:-1,page_before_rotate:-1,page_mode:0,page_rotate_id:0,Init:function(t){this.viewport=document.getElementById("AppViewport"),this.pages_container=document.getElementById("AppPagesContainer"),this.lst_pages=Array.from(document.querySelectorAll(".AppPage")),this.nr_pages=this.lst_pages.length,window.hasOwnProperty("cordova")?this.mouse_or_touch="mousedown":this.mouse_or_touch=void 0!==window.ontouchstart?"touchstart":"mousedown",App.onResize(null),this.client_onResize=t,window.visualViewport.addEventListener("resize",App.onResize.bind(App))},onResize:function(t){this.viewport_width=this.viewport.offsetWidth,this.viewport.style.height=window.visualViewport.height+"px",this.pages_container.style.width=this.nr_pages*this.viewport_width+"px",this.pages_container.style.left=-this.current_page_idx*this.viewport.offsetWidth+"px",this.lst_pages.forEach(t=>t.style.width=this.viewport_width+"px"),this.ShowCurrentPage(),this.TestPageMode(),null!==this.client_onResize&&this.client_onResize(this.viewport_width,this.viewport.offsetHeight)},GetWidth:function(){return this.viewport_width},GetHeight:function(){return this.viewport.offsetHeight},ShowPage:function(t=""){if("string"==typeof t){var e=0,s=t;for(t=this.current_page_idx;e<this.nr_pages;){if(this.lst_pages[e].id===s){t=e;break}e++}}return this.pages_container.style.left=-t*this.viewport.offsetWidth+"px",this.previous_page_idx=this.current_page_idx,this.current_page_idx=t},GetCurrentPage:function(){return this.current_page_idx},GetCurrentPageId:function(){return this.lst_pages[this.current_page_idx].id},ShowCurrentPage:function(){this.ShowPage(this.current_page_idx)},ShowPreviousPage:function(){this.ShowPage(this.current_page_idx)},SetPageMode:function(t,e){this.page_mode=t,this.page_rotate_id=e,this.TestPageMode()},TestPageMode:function(){this.show_page=!1,this.page_mode!==this.PAGE_FREE&&(Math.sign(this.viewport.offsetWidth-this.viewport.offsetHeight)!==this.page_mode?(-1===this.page_before_rotate&&(this.page_before_rotate=this.current_page_idx),this.ShowPage(this.page_rotate_id),this.show_page=!0):-1!==this.page_before_rotate&&(this.ShowPage(this.page_before_rotate),this.page_before_rotate=-1,this.show_page=!0)),this.show_page||this.ShowCurrentPage()},AddEventListener:function(t,e,s){"MOUSE||TOUCH"===e&&(e=this.mouse_or_touch),t.addEventListener(e,s)},Device:{}};App.Device.Touch=function(){return 0<navigator.maxTouchPoints},App.Device.iOS=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},App.Storage={prefix:null,obj:null},App.Storage.Init=function(t){this.prefix=t,this.obj=window.localStorage},App.Storage.Clear=function(){},App.Storage.RemoveItem=function(t){this.obj.removeItem(this.prefix+"_"+t)},App.Storage.SetItemJSON=function(t,e){this.obj.setItem(this.prefix+"_"+t,JSON.stringify(e))},App.Storage.GetItemJSON=function(t){return JSON.parse(this.obj.getItem(this.prefix+"_"+t))},App.Storage.PopulateItemJSON=function(t,e){var s=this.GetItemJSON(t);if(null===s)this.SetItemJSON(t,e);else for(var i in s)e.hasOwnProperty(i)&&(e[i]=s[i]);return null!==s};class CardPile extends FlexBox{constructor(t){super(t,"column","center","center",!0),this.id=t,this.lst_cards=[],this.delay=0,this.top_card_face=!1,this.base=new FlexBoxEntity(this.id+"_Base",!0);t=this.base.GetElement();t.classList.add("CardPileBase"),t.classList.add("Clickable"),App.AddEventListener(t,"MOUSE||TOUCH",this.onClickBase.bind(this)),t.addEventListener("contextmenu",Game.onContextMenu.bind(Game)),this.AddEntity(this.base,!0,!0),this.e_counter=document.createElement("p"),this.e_counter.classList.add("Hidden"),t.appendChild(this.e_counter)}GetCards(){return this.lst_cards}SetTopCardFace(t){this.top_card_face=t,0<this.lst_cards.length&&this.lst_cards[this.lst_cards.length-1].SetFaceUp(t)}onResize(t,e,s,i,a,r){super.onResize(t,e,s,i),this.SetEntitiesSize(a,r),this.SetEntitiesPosition(),this.SetCardsPosition(),this.e_counter.style.fontSize=Math.round(.09*t)+"px"}onClickBase(t){t.stopPropagation(),t.preventDefault(),Game.onClickCardPile(this)}SetCardsPosition(){const[e,s]=this.base.GetPosition();this.lst_cards.forEach(t=>t.SetPosition(e,s))}SetCardsIndex(){var e=1;this.lst_cards.forEach(t=>t.SetZindex(e++))}SetDelay(t){this.delay=t}AddCard(t,e=!0){var s;this.lst_cards.includes(t)||(this.lst_cards[e?"push":"unshift"](t),this.e_counter.innerHTML=this.lst_cards.length,t.SetLocation(this),[e,s]=this.base.GetPosition(),t.SetPosition(e,s),t.SetFaceUp(!1),Delay(this.delay,t).then(t=>{this.SetCardsIndex(),this.HideAllButTopCard()}))}GetCardFromTop(){var t;return 0===this.lst_cards.length?null:((t=this.lst_cards.pop()).SetZindex(1+this.lst_cards.length),t.SetHidden(!1),this.HideAllButTopCard(),this.e_counter.innerHTML=this.lst_cards.length,Game.OnCardPileLevel(this,this.lst_cards.length),t)}AddCardToTop(t){this.AddCard(t,!0)}AddCardToBottom(t){this.AddCard(t,!1)}HideAllButTopCard(){var t=this.lst_cards.length-1;if(0<=t){var e=this.lst_cards[t];for(e.SetHidden(!1),e.SetFaceUp(this.top_card_face),--t;0<=t;--t)(e=this.lst_cards[t]).SetHidden(!0),e.SetFaceUp(!1)}}_TopCard(){return this.lst_cards[this.lst_cards.length-1]}IsEmpty(){return 0===this.lst_cards.length}GetNrCards(){return this.lst_cards.length}RemoveCard(t){this.lst_cards.includes(t)&&(RemoveArrayElement(this.lst_cards,t),t.SetHidden(!1),this.e_counter.innerHTML=this.lst_cards.length,this.HideAllButTopCard())}ShowCounter(t){this.e_counter.classList[t?"remove":"add"]("Hidden"),t&&(this.e_counter.innerHTML=this.lst_cards.length)}}class Deck{constructor(t){this.lst_cards=[],this.lst_cards_out=[],this.nr_jokers=t,this.MakeCards(t)}MakeCards(t){for(var e,s,i,a=0,r=[],n=0;n<4;++n)for(i=this.GetSuitColor(n),r.includes(i)||r.push(i),e=1;e<=13;++e)s=new Card(a++,{value:n,symbol:this.GetSuitSymbol(n),color:i},{value:e,symbol:this.GetValueSymbol(e)}),this.lst_cards.push(s);for(var o=0,l=1;l<=t;++l)s=new Card(a++,{value:SUIT_JOKER,symbol:this.GetSuitSymbol(SUIT_JOKER),color:r[o]},{value:ROYAL_JOKER,symbol:this.GetValueSymbol(e)}),this.lst_cards.push(s),o=(1+o)%r.length}onResize(e){const s=Math.round(e/CARD_ASPECT_RATIO);return this.ForEachCard(t=>{null!==t&&t.SetSize(s,e)}),s}ForEachCard(t){this.lst_cards.forEach(t),this.lst_cards_out.forEach(t)}Shuffle(){ShuffleArray(this.lst_cards)}GetCard(){var t;return 0===this.lst_cards.length?null:(t=RemoveRandomElement(this.lst_cards),this.lst_cards_out.push(t),t)}GetRoyalCard(){var t;return 0===this.lst_cards.length||0===(t=this.lst_cards.filter(t=>t.IsRoyal())).length?null:(t=GetRandomElement(t),RemoveArrayElement(this.lst_cards,t),this.lst_cards_out.push(t),t)}Reset(){for(;this.lst_cards_out.length;)this.lst_cards.push(this.lst_cards_out.pop())}GetSuitSymbol(e){return LST_SUITS.filter(t=>t.id===e).pop().symbol}GetSuitColor(e){return LST_SUITS.filter(t=>t.id===e).pop().color}GetValueSymbol(e){return 1===e||11<=e&&e<=14?LST_ROYALS.filter(t=>t.value===e).pop().symbol:e}GetGetPairValue(t,e){return t.GetValue()+e.GetValue()}}class Dungeon extends FlexBox{constructor(){super("Dungeon","row","evenly","center",!0),this.lst_columns=[],this.lst_columns_hidden=[];for(var t,e=0;e<NR_DUNGOEN_COLUMNS;++e)t=new DungeonColumn(e),this.lst_columns.push(t),this.AddEntity(t,!0,!0),Game.AppendChild(t.GetElement())}GetCards(){var e=[];return this.lst_columns.forEach(t=>e=e.concat(t.GetCards())),this.lst_columns_hidden.forEach(t=>e=e.concat(t.GetCards())),e}RestoreColumns(){for(var t;t=this.lst_columns_hidden.pop();)t.SetHidden(!1),this.AddEntity(t,!0,!0),Game.AppendChild(t.GetElement())}HideColumn(t){t=this.GetColumn(t);t.SetHidden(!0),this.lst_columns_hidden.push(t),this.RemoveEntity(t,!0,!0),Game.RemoveChild(t.GetElement())}onResize(t,e,s,i){super.onResize(t,e,s,i),this.SetEntitiesSize(Math.round(t/4*.9),e),this.SetEntitiesPosition()}GetColumn(e){return this.lst_columns.filter(t=>t.GetId()===e).pop()}GetArea(t,e){return this.GetColumn(t).GetArea(e)}GetRoyalsArea(t){return this.GetArea(t,ROYALS_AREA_ID)}GetFightersArea(t){return this.GetArea(t,FIGHTERS_AREA_ID)}ReadyForLastAttacks(){var e=0,s=0;return this.lst_columns.forEach(t=>{t.ReadyForLastAttack()&&(e+=1),t.IsHidden()||(s+=1)}),e===s}}class DungeonColumn extends FlexBox{constructor(t){var e;super("DungeonColumn_"+t,"column","center","center",!0),this.id=t,this.element.classList.add("DungeonColumn"),this.hidden=!1,this.lst_areas=[];for(const s of[ROYALS_AREA_ID,FIGHTERS_AREA_ID])e=new DungeonColumnArea(s,t),s===ROYALS_AREA_ID&&e.SetCondense(ROYALS_CONDENSE),this.lst_areas.push(e),this.AddEntity(e,!0,!0),Game.AppendChild(e.GetElement())}GetCards(){var e=[];return this.lst_areas.forEach(t=>e=e.concat(t.GetCards())),e}GetId(){return this.id}SetSize(t,e){super.SetSize(t,e);var s=ROYALS_HEIGHT/(ROYALS_HEIGHT+3),i=3/(ROYALS_HEIGHT+3);this.lst_areas[0].SetSize(t,Math.floor(e*s)),this.lst_areas[1].SetSize(t,Math.floor(e*i))}GetArea(t){return this.lst_areas[t]}AddCardToArea(t,e){this.lst_areas[e].AddCard(t)}IsHidden(){return this.hidden}SetHidden(e){this.hidden=e,this.element.classList[e?"add":"remove"]("Hidden"),this.lst_areas.forEach(t=>t.SetHidden(e))}ReadyForLastAttack(){return this.lst_areas[FIGHTERS_AREA_ID].IsFull()&&1===this.lst_areas[ROYALS_AREA_ID].GetNrCards()}}class DungeonColumnArea extends FlexBox{constructor(t,e){super(["DungeonColumnArea",e,t].join("_"),"column",0===t?"end":"start","center",!0),this.id=t,this.column_id=e,this.element.classList.add("DungeonColumnArea"),this.element.classList.add("DungeonColumnArea"+(t===ROYALS_AREA_ID?"Royal":"Fighter")),t===FIGHTERS_AREA_ID?(this.element.classList.add("Clickable"),this.element.classList.add("FightersArea"),App.AddEventListener(this.element,"MOUSE||TOUCH",this.onClick.bind(this)),this.element.addEventListener("contextmenu",Game.onContextMenu.bind(Game))):this.element.classList.add("RoyalsArea"),this.lst_cards=[],this.MAX_CARDS=this.id===ROYALS_AREA_ID?MAX_CARDS_ROYALS:MAX_CARDS_ATTACK}GetCards(){return this.lst_cards}AddCard(t){this.lst_cards.length===this.MAX_CARDS||this.lst_cards.includes(t)||(this.lst_cards.push(t),t.SetSmooth(!0),t.SetFaceUp(this.id===FIGHTERS_AREA_ID||this.lst_cards.length===MAX_CARDS_ROYALS),t.SetLocation(this),t.SetZindex(this.lst_cards.length),this.AddEntity(t,!1,!0))}RemoveCard(t){this.lst_cards.includes(t)&&(RemoveArrayElement(this.lst_cards,t),this.RemoveEntity(t,!1,!0),this.id===ROYALS_AREA_ID)&&1===this.lst_cards.length&&this.lst_cards[0].SetFaceUp(!0)}onClick(t){t.stopPropagation(),t.preventDefault(),Game.onClickArea(this)}GetId(){return this.id}GetColumnId(){return this.column_id}GetNrCards(){return this.lst_cards.length}IsEmpty(){return 0===this.lst_cards.length}IsFull(){return this.lst_cards.length===this.MAX_CARDS}IsFightersArea(){return this.id===FIGHTERS_AREA_ID}GetAttackCards(){return this.IsFightersArea()?this.lst_cards.slice(0,2):null}GetCard(t){return!this.IsFightersArea()||this.lst_cards.length<=t?null:this.lst_cards[t]}GetTriggerCard(){return!this.IsFightersArea()||this.lst_cards.length!==MAX_CARDS_ATTACK?null:this.lst_cards[MAX_CARDS_ATTACK-1]}SetAttackable(t){if(this.IsFightersArea())return null;this.element.classList[t?"add":"remove"]("Attackable")}GetCurrentTarget(){return this.IsFightersArea()||this.lst_cards.length<1?null:this.lst_cards[this.lst_cards.length-1]}GetNextTarget(){return this.IsFightersArea()||this.lst_cards.length<=1?null:this.lst_cards[this.lst_cards.length-2]}SetHidden(t){this.element.classList[t?"add":"remove"]("Hidden")}}class Hand extends FlexBox{constructor(){super("Hand","row","evenly","center",!0),this.lst_cards=[],this.element.classList.add("Clickable"),App.AddEventListener(this.element,"MOUSE||TOUCH",this.onClick.bind(this)),this.element.addEventListener("contextmenu",Game.onContextMenu.bind(Game))}onResize(t,e,s,i){super.onResize(t,e,s,i),this.SetEntitiesPosition()}GetCards(){return this.lst_cards}AddCard(t){this.lst_cards.length===MAX_CARDS_HAND||this.lst_cards.includes(t)||(t.SetSmooth(!0),t.SetLocation(this),t.SetFaceUp(!0),t.SetZindex(100+this.lst_cards.length),this.lst_cards.push(t),this.AddEntity(t,!1,!0))}RemoveCard(t){this.lst_cards.includes(t)&&(RemoveArrayElement(this.lst_cards,t),this.RemoveEntity(t,!1,!0))}onClick(t){t.stopPropagation(),t.preventDefault(),Game.onClickHand(this)}IsEmpty(){return 0===this.lst_cards.length}IsFull(){return this.lst_cards.length===MAX_CARDS_HAND}}class Messenger{constructor(t){this.element=document.createElement("div"),this.element.id="Messenger",this.txt=document.createElement("p"),this.element.appendChild(this.txt),this.show_time=t,this.timer=null}SetShowTime(t){this.show_time=t}GetElement(){return this.element}onResize(t,e,s,i){this.element.style.width=t+"px",this.element.style.height=e+"px",this.element.style.left=i+"px",this.txt.style.fontSize=Math.min(Math.round(.25*e),17)+"px",this.Hide()}Hide(){this.element.style.top=-1.1*this.element.offsetHeight+"px"}Show(t,e){0<this.show_time&&(clearTimeout(this.timer),this.timer=setTimeout(this.Hide.bind(this),this.show_time),this.txt.innerHTML="<span>"+t+"</span>: "+e,this.element.style.top=0)}ShowForever(t){clearTimeout(this.timer),this.txt.innerHTML=t,this.element.style.top=0}}const DUNGEON_HAND_SPACING=.25,ROYALS_CONDENSE=.75,DUNGEON_WIDTH=.8,CARD_ASPECT_RATIO=16/11,DISTRIBUTE_ROYALS_SPEED=.2,DISTRIBUTE_HAND_SPEED=.2,DISTRIBUTE_KILL_SPEED=.5,_MAX_CARDS_AREA=3,NR_ROYALS=12,MAX_CARDS_ATTACK=3;var NR_DUNGOEN_COLUMNS=0,MAX_CARDS_ROYALS=0,ROYALS_HEIGHT=0,TOTAL_HEIGHT=0,DUNGEON_HEIGHT=0;const CARD_TRANSLATION_TIME=500,ROYALS_AREA_ID=0,FIGHTERS_AREA_ID=1,MAX_CARDS_HAND=3,SUIT_HEARTS=0,SUIT_SPADES=1,SUIT_DIAMONDS=2,SUIT_CLUBS=3,SUIT_JOKER=4;var ROYAL_JACK=11,ROYAL_QUEEN=12;const ROYAL_KING=13,ROYAL_JOKER=14,JOKER_MIN=2,JOKER_MAX=10,LST_SUITS_0=[{id:SUIT_HEARTS,symbol:"&hearts;",color:"Red"},{id:SUIT_SPADES,symbol:"&spades;",color:"Black"},{id:SUIT_DIAMONDS,symbol:"&diams;",color:"Red"},{id:SUIT_CLUBS,symbol:"&clubs;",color:"Black"},{id:SUIT_JOKER,symbol:"",color:""}],LST_ROYALS_0=[{value:"J",symbol:"J"},{value:"Q",symbol:"Q"},{value:ROYAL_KING,symbol:"K"},{value:ROYAL_JOKER,symbol:"&#x2605;"},{value:1,symbol:"A"}],LST_SUITS_1=[{id:SUIT_HEARTS,symbol:"&#x25B2;",color:"Red"},{id:SUIT_SPADES,symbol:"&#x25B2;",color:"Black"},{id:SUIT_DIAMONDS,symbol:"&#x25FC;",color:"Red"},{id:SUIT_CLUBS,symbol:"&#x25FC;",color:"Black"},{id:SUIT_JOKER,symbol:"",color:""}],LST_ROYALS_1=[{value:"J",symbol:"&#x268A;"},{value:"Q",symbol:"&#x268C;"},{value:ROYAL_KING,symbol:"&#x2630;"},{value:ROYAL_JOKER,symbol:"&#x25C9;"},{value:1,symbol:"1"}],LST_ROYALS_ALL=[LST_ROYALS_0,LST_ROYALS_1],LST_SUITS_ALL=[LST_SUITS_0,LST_SUITS_1];var LST_ROYALS=null,LST_SUITS=null;const Game={viewport:null,spacing:0,dungeon:null,hand:null,deck:null,draw_pile:null,discard_royals:null,discard_fighters:null,discard_graveyard:null,card_height:0,clicked_card:null,selected_card:null,in_game_stats:null,messenger:null,busy:!1};function ebi(t){return document.getElementById(t)}function ebt(t,e){return(e=e||document).getElementsByTagName(t)[0]}function abt(t,e){return(e=e||document).getElementsByTagName(t)}function ebc(t,e=document){return e.querySelector(t)}function abc(t,e=document){return e.querySelectorAll(t)}function GetParentNodebt(t,e){for(e=e.toUpperCase();t.tagName!==e;)t=t.parentNode;return t}function Delay(s,i=null){return new Promise((t,e)=>setTimeout(t,s,i))}function QuerySeachString(t,e=null,s=null,i=null){t=new URL(window.location).searchParams.get(t);return null===t||(null!==s&&"string"!==s&&("int"===s?t=a(t=parseInt(t,10),i):"float"===s?t=a(t=parseFloat(t,10),i):"boolean"===s?t=Boolean(parseInt(t,10)):"uppercase"===s?t=t.toUpperCase():"lowercase"===s&&(t=t.toLowerCase())),["string","uppercase","lowercase"].includes(s)&&null!==i&&!i.includes(t))?e:t;function a(t,e){var s;return null!==e&&(s=e[0],e=e[1],t<s?t=s:e<t&&(t=e)),t}}function ShuffleArray(t){for(var e=t.length-1;0<e;e--){var s=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[s],t[s]=i}}function CloneArray(t){return t.slice(0)}function RemoveArrayElement(t,e){return t.includes(e)?t.splice(t.indexOf(e),1).pop():null}function RemoveArrayIndex(t,e){return e>=t.length?null:t.splice(e,1).pop()}function RemoveRandomElement(t){return RemoveArrayIndex(t,Math.randomInt(0,t.length-1))}function GetRandomElement(t){return t[Math.randomInt(0,t.length-1)]}Game.Init=function(){App.Init(this.onResize.bind(this)),App.SetPageMode(App.PAGE_LANDSCAPE,"Rotate"),App.Storage.Init("CTD"),this.viewport=ebi("GameViewport"),this.in_game_stats=ebi("InGameStats"),this.Options.Init(),this.Menu.Init(),this.Menu.Hide(),this.deck=new Deck(this.Options.GetValue("nr_jokers")),this.dungeon=new Dungeon,this.hand=new Hand,this.draw_pile=new CardPile("DrawPile"),this.discard_royals=new CardPile("DiscardRoyals"),this.discard_fighters=new CardPile("DiscardFighters"),this.discard_graveyard=new CardPile("DiscardGraveyard"),this.messenger=new Messenger(this.Options.GetValue("warn_time")),document.body.appendChild(this.messenger.GetElement()),this.Options.GetValue("reuse_discard")?this.discard_fighters.SetTopCardFace(!0):ebi("stats_reused").style.display="none",this.discard_fighters.SetDelay(CARD_TRANSLATION_TIME),this.discard_royals.SetDelay(CARD_TRANSLATION_TIME),this.discard_graveyard.SetDelay(CARD_TRANSLATION_TIME),App.onResize(),ebi("AppViewport").classList.remove("AppInit"),App.AddEventListener(window,"contextmenu",this.onContextMenu.bind(this)),App.AddEventListener(window,"MOUSE||TOUCH",this.RequestFullscreen.bind(this)),App.AddEventListener(ebi("HomeCard"),"MOUSE||TOUCH",this.onClickHomeCard.bind(this)),this.PreStart();var t=QuerySeachString("goto","");"Play"===t?this.onClickHomeCard(null):""!==t&&App.ShowPage(t)},Game.onClickHomeCard=function(t){App.ShowPage("Play"),ebi("MenuIcon").classList.remove("Hidden"),Game.Menu.Show()},Game.AppendChild=function(t){this.viewport.appendChild(t)},Game.RemoveChild=function(t){t.remove()},Game.onResize=function(t,e){this.spacing=this.viewport.offsetTop;var t=Math.min(t-2*this.spacing,1.15*e),e=(this.viewport.style.width=Math.round(t)+"px",this.viewport.style.height=Math.round(window.visualViewport.height-2*this.spacing)+"px",this.Menu.IsVisible()||this.Menu.Hide(),Math.round(this.viewport.offsetWidth*DUNGEON_WIDTH)),t=Math.round(this.viewport.offsetHeight*DUNGEON_HEIGHT),s=(this.card_height=Math.round(this.viewport.offsetHeight*(1/TOTAL_HEIGHT)),this.deck.onResize(this.card_height)),i=(this.dungeon.onResize(e,t,0,0),this.hand.onResize(e,this.card_height,t+this.card_height*DUNGEON_HAND_SPACING,0),this.viewport.offsetWidth-e-this.spacing),a=this.card_height,r=e+this.spacing,t=(this.draw_pile.onResize(i,a,t+this.card_height*DUNGEON_HAND_SPACING,r,s,this.card_height),ROYALS_HEIGHT*this.card_height);this.discard_royals.onResize(i,a,t,r,s,this.card_height),this.discard_graveyard.onResize(i,a,t+ +this.card_height,r,s,this.card_height),this.discard_fighters.onResize(i,a,t+2*this.card_height,r,s,this.card_height),this.in_game_stats.style.height=Math.round(ROYALS_HEIGHT*this.card_height-this.spacing)+"px",this.in_game_stats.style.width=i+"px",this.in_game_stats.style.fontSize=Math.round(.09*i)+"px",this.messenger.onResize(e,(ROYALS_HEIGHT-1)*this.card_height,0,this.viewport.offsetLeft)},Game.GetCardHeight=function(){return this.card_height},Game.Start=function(){this.busy||(this.busy=!0,ebi("Menu_Play").classList.add("Hidden"),this.RequestFullscreen(),this.messenger.Hide(),this.deck.Reset(),this.deck.Shuffle(),this.Stats.Clear(),this.Stats.StopClock(),this.dungeon.RestoreColumns(),this.DiscardRemainingCards().then(t=>this.PrepareDrawPile()).then(t=>this.DistributeRoyals(DISTRIBUTE_ROYALS_SPEED)).then(t=>this.DistributeHand(DISTRIBUTE_HAND_SPEED)).then(t=>{this.draw_pile.SetDelay(CARD_TRANSLATION_TIME),this.draw_pile.ShowCounter(!0),this.discard_fighters.ShowCounter(!0),this.Stats.StartClock(),ebi("Menu_Play").classList.remove("Hidden"),this.busy=!1}))},Game.PrepareDrawPile=function(){for(;card=this.deck.GetRoyalCard();)this.MoveCardToLocation(card,this.draw_pile,1);for(;card=this.deck.GetCard();)this.MoveCardToLocation(card,this.draw_pile,-1);return Promise.resolve(null)},Game.DistributeRoyals=function(t=DISTRIBUTE_ROYALS_SPEED){for(var s=[],e=0;e<NR_DUNGOEN_COLUMNS;++e)for(var i=1;i<=MAX_CARDS_ROYALS;++i)s.push(e);ShuffleArray(s);for(var a=[],r=0,n=CARD_TRANSLATION_TIME*t,i=NR_ROYALS;0<i--;)a.push(Delay(r).then(t=>{var e=Game.draw_pile.GetCardFromTop();Game.dungeon.GetArea(s.pop(),0).AddCard(e)})),r+=n;return a.push(Delay(3*CARD_TRANSLATION_TIME)),Promise.all(a)},Game.DistributeHand=function(t=DISTRIBUTE_HAND_SPEED){this.Undo.Clear();for(var e=[],s=0,i=CARD_TRANSLATION_TIME*t,a=Math.min(MAX_CARDS_HAND,this.draw_pile.GetNrCards());0<a--;)e.push(Delay(s).then(t=>{var e=Game.draw_pile.GetCardFromTop();Game.hand.AddCard(e)})),s+=i;return e.push(Delay(s)),Promise.all(e)},Game.onClickCard=function(t){if(this.RequestFullscreen(),(this.clicked_card=t).IsFaceDown())return t.IsAt(this.discard_fighters)&&this.TestAndDiscardSelectedCard()?void 0:void this.Warn("Card","I'm face down, let me be.");var e=t.GetLocation();e instanceof DungeonColumnArea&&e.IsFightersArea()?this.Warn("Attack card","Undo? Click your hand area. Attack? Click the royal."):e===this.discard_fighters&&null!==this.selected_card&&t!==this.selected_card?this.TestAndDiscardSelectedCard():t.ToggleSelected()?(null!==this.selected_card&&this.selected_card.SetSelected(!1),(this.selected_card=t).IsRoyal()&&(this.ClearCardSelection(),this.TestAttack(t))&&(this.Stats.AddToKey("nr_attacks",1),this.TestGameOver(!0)),this.selected_card):this.selected_card=null},Game.ClearCardSelection=function(){this.selected_card instanceof Card&&this.selected_card.SetSelected(!1),this.selected_card=null},Game.onClickArea=function(t){this.RequestFullscreen();var e=this.dungeon.GetRoyalsArea(t.GetColumnId());if(!e.IsEmpty())if(null===this.selected_card)t.IsFull()?this.Warn("Prepare attack","I'm ready, click the royal card."):this.Warn("Prepare attack","Select a card and play it here.");else{var s=this.selected_card.GetLocation();if(s===this.hand||s===this.discard_fighters&&!this.selected_card.IsFaceDown()){var i=e.GetCurrentTarget();if(t.GetNrCards()<MAX_CARDS_ATTACK-1){if(!this.ValidateAttackCards(i))return this.ClearCardSelection(),!1}else{if(!this.TestTriggerCard(this.selected_card,i))return this.ClearCardSelection(),!1;e.SetAttackable(!0)}s===this.discard_fighters?(this.Undo.PurgeCards([this.selected_card]),this.Undo.PurgeCards(t.GetAttackCards()),this.Stats.AddToKey("reused",1)):this.Undo.AddCard(this.selected_card),this.MoveCardToLocation(this.selected_card,t),this.hand.IsEmpty()&&Delay(CARD_TRANSLATION_TIME).then(t=>Game.DistributeHand()).then(t=>{Game.TestGameOver()})}}},Game.TestGameOver=function(t=!1){var e=0;t?this.Stats.GetKeyValue("nr_attacks")===NR_ROYALS&&(e=1):(this.dungeon.ReadyForLastAttacks(),this.hand.IsEmpty()&&!this.dungeon.ReadyForLastAttacks()&&(e=-1)),0!==e&&(this.Stats.StopClock(),this.messenger.ShowForever(1===e?"Congratulations! Up to another?":"Almost there... Try again!"))},Game.onClickHand=function(t){var e,s;this.RequestFullscreen(),t.IsFull()?this.Warn("Undo","Hand is full."):(e=this.Undo.GetCard())instanceof Card?((s=e.GetLocation())!==this.discard_fighters&&this.dungeon.GetRoyalsArea(s.GetColumnId()).SetAttackable(!1),this.MoveCardToLocation(e,t)):this.Warn("Undo","Sorry, no card available.")},Game.onClickCardPile=function(t){this.RequestFullscreen(),t!==this.discard_fighters?t===this.discard_royals?this.Warn("Discard royals","I can manage myself, thanks."):t===this.discard_graveyard?this.Warn("Graveyard","I can manage myself, thanks."):t===this.draw_pile&&this.Warn("Draw pile","I can manage myself, thanks."):null===this.selected_card?this.Warn("Discard fighters","Select a card from your hand."):this.TestAndDiscardSelectedCard()},Game.TestAndDiscardSelectedCard=function(){var t=this.selected_card;return null!==t&&!!t.IsAt(this.hand)&&(this.Undo.AddCard(t),this.DiscardCard(t),this.hand.IsEmpty()&&Delay(CARD_TRANSLATION_TIME).then(t=>Game.DistributeHand()).then(t=>{Game.TestGameOver()}),!0)},Game.MoveCardToLocation=function(t,e,s=0){e instanceof FlexBox&&t instanceof Card&&(t.GetLocation().RemoveCard(t),e===this.discard_fighters?e.AddCardToBottom(t):0===s?e.AddCard(t):1===s?e.AddCardToTop(t):-1===s&&e.AddCardToBottom(t),this.ClearCardSelection())},Game.TestAttack=function(t){var e,s,i,a=this.dungeon.GetFightersArea(t.GetLocation().GetColumnId());return a.IsFull()?(e=a.GetTriggerCard(),!(!this.TestTriggerCard(e,t)||([a,s]=a.GetAttackCards(),(i=this.deck.GetGetPairValue(a,s))<t.GetValue())||(a.IsJoker()||a.IsJoker()||(i=i-t.GetValue(),this.Stats.AddToKey("overkill",i)),this.ExecuteAttack([t,a,s,e]),0))):(this.Warn("Start attack","Place two attack cards and a trigger card."),!1)},Game.TestTriggerCard_Joker=function(t,e){return!this.Options.GetValue("joker_trigger_color")||t.GetColor()===e.GetColor()||(this.Warn("Prepare attack","Trigger joker must match color."),!1)},Game.TestTriggerCard_Default=function(t,e,s=!1){s=s?"ace_":"";if(this.Options.GetValue(s+"trigger_suit")){if(t.GetSuit()!==e.GetSuit())return this.Warn("Prepare attack","Trigger card must match suit."),!1}else if(this.Options.GetValue(s+"trigger_color")&&t.GetColor()!==e.GetColor())return this.Warn("Prepare attack","Trigger card must match color."),!1;s=this.Options.GetValue(s+"trigger_value");if("any"!==s){var[i,a]=this.dungeon.GetFightersArea(e.GetLocation().GetColumnId()).GetAttackCards(),e=this.GetMinimumValue(e.GetValue(),i,a),i=t.GetValue();if("ge"===s){if(i<e)return this.Warn("Prepare attack","Trigger card must be &ge; "+e+"."),!1}else if(i<=e)return this.Warn("Prepare attack","Trigger card must be &gt; "+e+"."),!1}return!0},Game.TestTriggerCard_Ace=function(t,e){return this.TestTriggerCard_Default(t,e,!0)},Game.TestTriggerCard=function(t,e){return t.IsJoker()?this.TestTriggerCard_Joker(t,e):t.IsAce()?this.TestTriggerCard_Ace(t,e):this.TestTriggerCard_Default(t,e)},Game.GetMinimumValue=function(t,e,s){var i=s.GetValue();return e.IsJoker()?t-i:(e=e.GetValue(),s.IsJoker()?t-e:Math.min(e,i))},Game.ValidateAttackCards=function(t){var e,s=this.dungeon.GetFightersArea(t.GetLocation().GetColumnId()),i=s.GetCard(0);if(null===i?(i=this.selected_card,e=null):null===(e=s.GetCard(1))&&(e=this.selected_card),this.Options.GetValue("joker_attack_color")){var s=t.GetColor(),a=!0;if(null!==i&&i.IsJoker()&&i.GetColor()!==s&&(a=!1),!(a=null!==e&&e.IsJoker()&&e.GetColor()!==s?!1:a))return this.Warn("Prepare attack","Attack joker must match color"),!1}s=null===i?0:i.GetValue(),a=null===e?0:e.GetValue(),i=t.GetValue();return 0===a?i<=s+10||(this.Warn("Prepare attack",[i,"-",s,"&gt;",10].join(" ")),!1):i<=s+a||(this.Warn("Prepare attack",[s,"+",a,"&lt;",i].join(" ")),!1)},Game.ExecuteAttack=function(t){const[e,s,i,a]=t;for(var r=[],n=0,o=CARD_TRANSLATION_TIME*DISTRIBUTE_KILL_SPEED,l=3;0<=l;)r.push(Delay(n,t[l--]).then(t=>{t.SetZindex(100+l),this.DiscardCard(t,!0)})),n+=o;r.push(Delay(n));const h=this.dungeon.GetFightersArea(a.GetLocation().GetColumnId()),d=this.dungeon.GetRoyalsArea(a.GetLocation().GetColumnId()),c=e.GetLocation().GetNextTarget();Promise.all(r).then(t=>{d.SetAttackable(!1),this.Undo.PurgeCards([s,i,a]),null!==c?c.SetFaceUp(!0):this.dungeon.HideColumn(h.GetColumnId())})},Game.Warn=function(t,e){this.messenger.Show(t,e)},Game.OnCardPileLevel=function(t,e){t===this.draw_pile&&e<=this.Options.GetValue("warn_draw_level")&&this.Warn("Draw pile",e+" left.")},Game.onContextMenu=function(t){this.RequestFullscreen(),t.stopPropagation(),t.preventDefault(),t.target.click()},Game.RequestFullscreen=function(){App.Device.Touch()&&!App.Device.iOS()&&document.body.requestFullscreen&&document.body.requestFullscreen()},Game.DiscardCard=function(t,e=!1){t instanceof Card&&(t===this.selected_card&&this.ClearCardSelection(),t.SetZindex(100),this.MoveCardToLocation(t,t.IsRoyal()?this.discard_royals:e?this.discard_graveyard:this.discard_fighters))},Game.DiscardRemainingCards=function(){var t=[];t=(t=(t=(t=t.concat(this.discard_fighters.GetCards())).concat(this.hand.GetCards())).concat(this.dungeon.GetCards())).concat(this.draw_pile.GetCards());const s=CARD_TRANSLATION_TIME*DISTRIBUTE_ROYALS_SPEED;var i=[],a=0;return t.forEach(e=>{i.push(Delay(a).then(t=>{this.DiscardCard(e,!0)})),a+=s}),i.push(Delay(a+CARD_TRANSLATION_TIME)),Promise.all(i)},Game.PreStart=function(){for(var t;t=this.deck.GetCard();)(t.IsRoyal()?this.discard_royals:this.discard_graveyard).AddCard(t)},Game.Undo={lst:[]},Game.Undo.Clear=function(){for(;this.lst.pop(););},Game.Undo.AddCard=function(t){this.lst.includes(t),this.lst.push(t)},Game.Undo.GetCard=function(){return 0===this.lst.length?null:this.lst.pop()},Game.Undo.PurgeCards=function(t){0!==this.lst.length&&t.forEach(t=>{RemoveArrayElement(this.lst,t)})},Game.Menu={menu_pannel:null},Game.Menu.Init=function(){this.menu_pannel=ebi("MenuPannel"),App.AddEventListener(ebi("MenuIcon"),"MOUSE||TOUCH",Game.Menu.Toggle.bind(Game.Menu)),Array.from(abt("p",this.menu_pannel)).forEach(t=>{t.classList.add("Clickable"),App.AddEventListener(t,"MOUSE||TOUCH",this.onClickIcon.bind(this))})},Game.Menu.onClickIcon=function(t){t=t.target.id.split("_").pop();"Home"===t?(ebi("MenuIcon").classList.add("Hidden"),Game.Menu.Toggle()):"Play"===t?"Play"===App.GetCurrentPageId()&&Game.Start():"Options"===t&&ebi("OptionsApply").classList.add("Hidden"),App.ShowPage(t)},Game.Menu.Show=function(){this.menu_pannel.style.right=0},Game.Menu.IsVisible=function(){return this.menu_pannel.style.right.length<=3},Game.Menu.Hide=function(){this.menu_pannel.style.right=-this.menu_pannel.offsetWidth+"px"},Game.Menu.Toggle=function(t){this.IsVisible()?this.Hide():this.Show()},Game.Options={key:"options",data:{cards:{type:"int",value:0,values:[0,1],labels:["Default","Abstract"],restart:2},reuse_discard:{type:"boolean",value:!1,restart:2},royals_sequence:{type:"string",value:"JQK",values:["JQK","QJK"],restart:2},nr_jokers:{type:"int",value:2,values:[0,1,2,3,4],restart:2},show_royals_value:{type:"boolean",value:!0,restart:2},nr_columns:{type:"int",value:3,values:[3,4],restart:2},warn_time:{type:"int",value:4,values:[0,3,4,5],restart:0},warn_draw_level:{type:"int",value:6,values:[0,3,6,9],restart:0},trigger_suit:{type:"boolean",value:!0,restart:0},ace_trigger_suit:{type:"boolean",value:!0,restart:0},trigger_color:{type:"boolean",value:!0,restart:0},ace_trigger_color:{type:"boolean",value:!0,restart:0},trigger_value:{type:"string",value:"any",values:["any","ge","gt"],labels:["Unrelated","&ge;","&gt;"],restart:0},ace_trigger_value:{type:"string",value:"any",values:["any","ge","gt"],labels:["Unrelated","&ge;","&gt;"],restart:0},joker_trigger_color:{type:"boolean",value:!1,restart:0},joker_attack_color:{type:"boolean",value:!1,restart:0}}},Game.Options.MakeStorageData=function(){var t,e={};for(t in this.data)e[t]=this.data[t].value;return e},Game.Options.UpdateStorage=function(){App.Storage.SetItemJSON(this.key,this.MakeStorageData())},Game.Options.UpdateFromStorage=function(t){for(var e in t)this.data[e].value=t[e]},Game.Options.Init=function(){var t=this.MakeStorageData();App.Storage.PopulateItemJSON(this.key,t)&&this.UpdateFromStorage(t),1===this.data.cards.value&&(this.data.show_royals_value.value=!1,this.data.royals_sequence.value="JQK"),this.data.trigger_suit.value&&(this.data.trigger_color.value=!0),this.data.ace_trigger_suit.value&&(this.data.ace_trigger_color.value=!0);this.data;this.InitOptionsPage(),this.data.warn_time.value*=1e3,ebi("stats_reused").style.display=this.data.reuse_discard.value?"":"none",this.InitConst(),this.InitRoyalsSequence()},Game.Options.InitOptionsPage=function(){var t,e,s=ebt("div",ebi("Options"));for(t in this.data)(e=document.createElement("p")).classList.add("OptionsParagraph"),this.MakeInput(t,e),s.appendChild(e);var i=ebi("OptionsApply");i.classList.add("Hidden"),App.AddEventListener(i,"MOUSE||TOUCH",this.Apply.bind(this))},Game.Options.Apply=function(t){t.preventDefault(),t.stopPropagation();t=self.location.protocol+"//"+self.location.host+self.location.pathname;self.location=t+"?goto=Play"},Game.Options.MakeInput=function(t,e){var s,i,a,r,n,o=this.data[t],l=document.createElement("span"),h=(l.classList.add("Restart_"+o.restart),l.innerHTML=t,e.appendChild(l),"boolean"===o.type?(s=["Yes","No"],n=!0):(n=!1,s=o.values),0);for(i of s)(a=document.createElement("input")).type="radio",a.id=t+"_"+i,a.name=t,a.value=n?"Yes"===i?1:0:i,a.checked=(n?"Yes"===i:i)===this.data[t].value,a.addEventListener("change",this.onChangeInput.bind(this)),(r=document.createElement("label")).for=a.id,void 0!==o.labels?r.innerHTML=o.labels[h]:r.innerHTML=i,e.appendChild(a),e.appendChild(r),++h},Game.Options.onChangeInput=function(t){var t=t.target,e=t.name,s=t.value;"int"===this.data[e].type?s=parseInt(s,10):"boolean"===this.data[e].type&&(s="1"===s),"warn_time"===e&&(s*=1e3,Game.messenger.SetShowTime(s)),this.data[t.name].value=s,this.UpdateStorage(),2===this.data[e].restart&&ebi("OptionsApply").classList.remove("Hidden")},Game.Options.InitQueryValues=function(){function t(t,e,s){return QuerySeachString(t,Game.Options.data[t].value,e,s)}var e=this.data;e.trigger_value.value=t("trigger_value","lowercase",["any","ge","gt"]),e.ace_trigger_value.value=t("ace_trigger_value","lowercase",["any","ge","gt"]),e.royals_sequence.value=t("royals_sequence","uppercase",["JQK","QJK"]),e.nr_jokers.value=t("nr_jokers","int",[0,4]),e.nr_columns.value=t("nr_columns","int",[3,4]),e.warn_draw_level.value=t("warn_draw_level","int",[0,12]),e.cards.value=t("cards","int",[0,1]),e.warn_time.value=t("warn_time","float",[0,5]),e.show_royals_value.value=t("show_royals_value","boolean"),e.reuse_discard.value=t("reuse_discard","boolean"),e.joker_trigger_color.value=t("joker_trigger_color","boolean"),e.trigger_suit.value=t("trigger_suit","boolean"),e.ace_trigger_suit.value=t("ace_trigger_suit","boolean"),e.ace_trigger_color.value=t("ace_trigger_color","boolean")},Game.Options.GetValue=function(t){return this.data[t].value},Game.Options.InitConst=function(){NR_DUNGOEN_COLUMNS=this.data.nr_columns.value,MAX_CARDS_ROYALS=NR_ROYALS/NR_DUNGOEN_COLUMNS,ROYALS_HEIGHT=MAX_CARDS_ROYALS-(MAX_CARDS_ROYALS-1)*ROYALS_CONDENSE,TOTAL_HEIGHT=ROYALS_HEIGHT+MAX_CARDS_ATTACK+DUNGEON_HAND_SPACING+1,DUNGEON_HEIGHT=(ROYALS_HEIGHT+MAX_CARDS_ATTACK)/TOTAL_HEIGHT,LST_ROYALS=LST_ROYALS_ALL[this.data.cards.value],LST_SUITS=LST_SUITS_ALL[this.data.cards.value]},Game.Options.InitRoyalsSequence=function(){"QJK"===this.data.royals_sequence.value?(ROYAL_QUEEN=11,ROYAL_JACK=12):(ROYAL_JACK=11,ROYAL_QUEEN=12);for(var t of LST_ROYALS)"J"===t.value?t.value=ROYAL_JACK:"Q"===t.value&&(t.value=ROYAL_QUEEN)},Game.Stats={keys:{reused:0,overkill:0,time:0,nr_attacks:0},timer:null},Game.Stats.AddToKey=function(t,e){this.keys[t]+=e;e=ebi("txt_stats_"+t);return null!==e&&(e.innerHTML=this.keys[t]),this.keys[t]},Game.Stats.GetKeyValue=function(t){return this.keys[t]},Game.Stats.Clear=function(){this.keys.reused=0,this.keys.overkill=0,ebi("txt_stats_reused").innerHTML=this.keys.reused,ebi("txt_stats_overkill").innerHTML=this.keys.overkill,this.keys.time=0,this.keys.nr_attacks=0},Game.Stats.TickClock=function(){this.AddToKey("time",1),ebi("txt_stats_time").innerHTML=this.keys.time,this.timer=setTimeout(this.TickClock.bind(this),1e3)},Game.Stats.StartClock=function(){this.keys.time=0,ebi("txt_stats_time").innerHTML=this.keys.time,this.timer=setTimeout(this.TickClock.bind(this),1e3)},Game.Stats.StopClock=function(){clearTimeout(this.timer)},window.addEventListener("load",()=>{Game.Init()}),Math.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};