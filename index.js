'use strict;'
class FlexBoxEntity{constructor(t,s=!1){this.id=t,this.top=1/0,this.left=1/0,this.width=1/0,this.height=1/0,this.element=s?this.m0():null}m0(){var t=document.createElement("div");return t.id=this.id,t.classList.add("FlexBoxEntity"),A3.f22(t),t}m1(){return this.id}m2(){return this.element}f2(){return this.width}f3(){return this.height}m3(){return[this.top,this.left]}f1(t,s,e,i){this.m5(e,i),this.m4(t,s)}m4(t,s){this.width=t,this.height=s,null!==this.element&&(this.element.style.width=t+"px",this.element.style.height=s+"px")}m5(t,s){this.top=t,this.left=s,null!==this.element&&(this.element.style.top=t+"px",this.element.style.left=s+"px")}}class FlexBox extends FlexBoxEntity{constructor(t,s,e,i,n=!1){super(t,n),this.orientation=s,this.justify=e,this.align=i,n&&this.element.classList.add("FlexBox"),this.condense=0,this.lst_entities_ctrl_size=[],this.lst_entities_ctrl_position=[]}m6(t){this.condense=t}f1(t,s,e,i){super.f1(t,s,e,i)}m7(t,s,e,i=!0){i=i?"push":"unshift";s&&this.lst_entities_ctrl_size[i](t),e&&(this.lst_entities_ctrl_position[i](t),this.m10())}m8(t,s,e){s&&k12(this.lst_entities_ctrl_size,t),e&&(k12(this.lst_entities_ctrl_position,t),this.m10())}m9(s,e){0<this.lst_entities_ctrl_size.length&&this.lst_entities_ctrl_size.forEach(t=>t.m4(s,e))}m5(t,s){super.m5(t,s),this.m10()}m10(){var s,e,i,n;0<this.lst_entities_ctrl_position.length&&(e=s=0,this.lst_entities_ctrl_position.forEach(t=>{s+=t.f2(),e+=t.f3()}),"row"===this.orientation?(i=this["MakeDistributionList_"+this.justify](!0,"width",s),n=this["MakeDistributionList_"+this.align](!1,"height",e)):(n=this["MakeDistributionList_"+this.justify](!0,"height",e),i=this["MakeDistributionList_"+this.align](!1,"width",s)),this.lst_entities_ctrl_position.forEach(t=>{t.m5(n.shift(),i.shift())}))}m11(t,s){for(var e,i=this["width"===s?"left":"top"],n=[],r=0;r<this.lst_entities_ctrl_position.length;++r)t&&0<r&&(e=this.lst_entities_ctrl_position[r-1],i+="width"===s?e.f2():e.f3()),n.push(i);return n}MakeDistributionList_start(t,s,e){return this.m11(t,s)}MakeDistributionList_center(t,s,e){for(var i,n=this.m11(t,s),r=Math.round((this[s]-e)/2),a=0;a<this.lst_entities_ctrl_position.length;++a)t?n[a]+=r:(i=this.lst_entities_ctrl_position[a],n[a]+=Math.round((this[s]-("width"===s?i.f2():i.f3()))/2));return n}MakeDistributionList_end(t,s,e){for(var i,n,r=this.m11(t,s),a=Math.round(this[s]-e),h=this.lst_entities_ctrl_position.length,l=0;l<h;++l)t?(r[l]+=a,this.condense&&l<h-1&&(i=this.lst_entities_ctrl_position[l],n="width"===s?i.f2():i.f3(),r[l]+=(h-1-l)*n*this.condense)):(i=this.lst_entities_ctrl_position[l],r[l]+=this[s]-("width"===s?i.f2():i.f3()));return r}MakeDistributionList_evenly(t,s,e){for(var i=this.m11(t,s),n=this.lst_entities_ctrl_position.length,r=Math.round((this[s]-e)/(n+1)),a=0;a<n;++a)i[a]+=(a+1)*r;return i}}class Card extends FlexBoxEntity{constructor(t,s,e){super("Card_"+t,!0),this.id=t,this.suit=s.value,this.value=e.value,this.face_up=!1,this.selected=!1,this.location=null,this.e_body=null,this.e_face=null,this.e_back=null,this.e_value=null,this.e_suit=null,this.color=s.color,this.m17(s.color),this.element.classList.add("Card"),this.element.classList.add("CardHidden"),this.e_body.classList.add("FaceDown"),(this.m21()||this.m22())&&this.e_face.classList.add("CardRoyal"),this.e_suit.innerHTML=s.symbol,this.e_value.innerHTML=e.symbol,A3.A6.f66("show_royals_value")&&this.m21()&&(this.e_value.innerHTML+="<span>"+this.value+"<span>"),A0.f13(this.e_body,"MOUSE||TOUCH",this.onClick.bind(this)),this.e_body.addEventListener("contextmenu",A3.f47.bind(A3))}onClick(t){t.stopPropagation(),t.preventDefault(),A3.f29(this)}f66(){return this.value!==ROYAL_JOKER?this.value:JOKER_MAX}m12(){return this.suit}m13(){return this.color}m4(t,s){super.m4(t,s),this.e_value.style.fontSize=Math.round(.3*t)+"px",this.e_value.children.length&&(this.e_value.children[0].style.fontSize=Math.round(.2*t)+"px"),this.e_suit.style.fontSize=Math.round(.4*t)+"px"}m14(t){this.face_up=t,this.e_body.classList[t?"remove":"add"]("FaceDown")}m15(t){this.selected=t,this.e_body.classList[t?"add":"remove"]("CardSelected")}m16(){return this.m15(!this.selected),this.selected}m17(t){this.e_body=document.createElement("div"),this.e_body.classList.add("CardBody"),this.e_body.classList.add("Clickable"),this.element.appendChild(this.e_body),this.e_face=document.createElement("div"),this.e_face.classList.add("CardFace"),this.e_body.appendChild(this.e_face),this.e_back=document.createElement("div"),this.e_back.classList.add("CardBack"),this.e_body.appendChild(this.e_back),this.e_value=document.createElement("p"),this.e_value.classList.add("CardValue"),this.e_value.classList.add("CardValue"+t),this.e_face.appendChild(this.e_value),this.e_suit=document.createElement("p"),this.e_suit.classList.add("CardSuit"),this.e_suit.classList.add("CardSuit"+t),this.e_face.appendChild(this.e_suit)}m18(t){this.location=t}m19(t){return this.location===t}m20(){return this.location}m21(){return[ROYAL_JACK,ROYAL_QUEEN,ROYAL_KING].includes(this.value)}m22(){return this.value===ROYAL_JOKER}m23(){return 1===this.value}m24(){return this.face_up}m25(){return!this.face_up}m26(){return this.selected}m27(t){this.element.classList[t?"add":"remove"]("CardHidden")}m28(t){this.element.classList[t?"add":"remove"]("CardSmooth")}m29(t){this.element.style.zIndex=t}}const A0={viewport:null,viewport_width:0,pages_container:null,nr_pages:0,lst_pages:null,current_page_idx:0,previous_page_idx:0,client_onResize:null,mouse_or_touch:null,PAGE_FREE:0,PAGE_LANDSCAPE:1,PAGE_PORTRAIT:-1,page_before_rotate:-1,page_mode:0,page_rotate_id:0,f0:function(t){this.viewport=document.getElementById("AppViewport"),this.pages_container=document.getElementById("AppPagesContainer"),this.lst_pages=Array.from(document.querySelectorAll(".AppPage")),this.nr_pages=this.lst_pages.length,window.hasOwnProperty("cordova")?this.mouse_or_touch="mousedown":this.mouse_or_touch=void 0!==window.ontouchstart?"touchstart":"mousedown",A0.f1(null),this.client_onResize=t,window.visualViewport.addEventListener("resize",A0.f1.bind(this))},f1:function(t){this.viewport_width=this.viewport.offsetWidth,this.viewport.style.height=window.visualViewport.height+"px",this.pages_container.style.width=this.nr_pages*this.viewport_width+"px",this.pages_container.style.left=-this.current_page_idx*this.viewport.offsetWidth+"px",this.lst_pages.forEach(t=>t.style.width=this.viewport_width+"px"),this.f9(),this.f12(),null!==this.client_onResize&&this.client_onResize(this.viewport_width,this.viewport.offsetHeight)},f2:function(){return this.viewport_width},f3:function(){return this.viewport.offsetHeight},f6:function(t=""){if("string"==typeof t){var s=0,e=t;for(t=this.current_page_idx;s<this.nr_pages;){if(this.lst_pages[s].id===e){t=s;break}s++}}return this.pages_container.style.left=-t*this.viewport.offsetWidth+"px",this.previous_page_idx=this.current_page_idx,this.current_page_idx=t},f7:function(){return this.current_page_idx},f8:function(){return this.lst_pages[this.current_page_idx].id},f9:function(){this.f6(this.current_page_idx)},f10:function(){this.f6(this.current_page_idx)},f11:function(t,s){this.page_mode=t,this.page_rotate_id=s,this.f12()},f12:function(){this.show_page=!1,this.page_mode!==this.PAGE_FREE&&(Math.sign(this.viewport.offsetWidth-this.viewport.offsetHeight)!==this.page_mode?(-1===this.page_before_rotate&&(this.page_before_rotate=this.current_page_idx),this.f6(this.page_rotate_id),this.show_page=!0):-1!==this.page_before_rotate&&(this.f6(this.page_before_rotate),this.page_before_rotate=-1,this.show_page=!0)),this.show_page||this.f9()},f13:function(t,s,e){"MOUSE||TOUCH"===s&&(s=this.mouse_or_touch),t.addEventListener(s,e)},A1:{}};A0.A1.f14=function(){return 0<navigator.maxTouchPoints},A0.A1.f15=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},A0.A2={prefix:null,obj:null},A0.A2.f0=function(t){this.prefix=t,this.obj=window.localStorage},A0.A2.f16=function(){},A0.A2.f17=function(t){this.obj.removeItem(this.prefix+"_"+t)},A0.A2.f18=function(t,s){this.obj.setItem(this.prefix+"_"+t,JSON.stringify(s))},A0.A2.f19=function(t){return JSON.parse(this.obj.getItem(this.prefix+"_"+t))},A0.A2.f20=function(t,s){var e=this.f19(t);if(null===e)this.f18(t,s);else for(var i in e)s.hasOwnProperty(i)&&(s[i]=e[i]);return null!==e};class CardPile extends FlexBox{constructor(t){super(t,"column","center","center",!0),this.id=t,this.lst_cards=[],this.delay=0,this.top_card_face=!1,this.base=new FlexBoxEntity(this.id+"_Base",!0);t=this.base.m2();t.classList.add("CardPileBase"),t.classList.add("Clickable"),A0.f13(t,"MOUSE||TOUCH",this.onClickBase.bind(this)),t.addEventListener("contextmenu",A3.f47.bind(A3)),this.m7(this.base,!0,!0),this.e_counter=document.createElement("p"),this.e_counter.classList.add("Hidden"),t.appendChild(this.e_counter)}m30(){return this.lst_cards}m31(t){this.top_card_face=t,0<this.lst_cards.length&&this.lst_cards[this.lst_cards.length-1].m14(t)}f1(t,s,e,i,n,r){super.f1(t,s,e,i),this.m9(n,r),this.m10(),this.m32(),this.e_counter.style.fontSize=Math.round(.09*t)+"px"}onClickBase(t){t.stopPropagation(),t.preventDefault(),A3.f34(this)}m32(){const[s,e]=this.base.m3();this.lst_cards.forEach(t=>t.m5(s,e))}m33(){var s=1;this.lst_cards.forEach(t=>t.m29(s++))}m34(t){this.delay=t}f52(t,s=!0){var e;this.lst_cards.includes(t)||(this.lst_cards[s?"push":"unshift"](t),this.e_counter.innerHTML=this.lst_cards.length,t.m18(this),[s,e]=this.base.m3(),t.m5(s,e),t.m14(!1),k7(this.delay,t).then(t=>{this.m33(),this.m38()}))}m35(){var t;return 0===this.lst_cards.length?null:((t=this.lst_cards.pop()).m29(1+this.lst_cards.length),t.m27(!1),this.m38(),this.e_counter.innerHTML=this.lst_cards.length,A3.f46(this,this.lst_cards.length),t)}m36(t){this.f52(t,!0)}m37(t){this.f52(t,!1)}m38(){var t=this.lst_cards.length-1;if(0<=t){var s=this.lst_cards[t];for(s.m27(!1),s.m14(this.top_card_face),--t;0<=t;--t)(s=this.lst_cards[t]).m27(!0),s.m14(!1)}}_TopCard(){return this.lst_cards[this.lst_cards.length-1]}m39(){return 0===this.lst_cards.length}m40(){return this.lst_cards.length}m41(t){this.lst_cards.includes(t)&&(k12(this.lst_cards,t),t.m27(!1),this.e_counter.innerHTML=this.lst_cards.length,this.m38())}m42(t){this.e_counter.classList[t?"remove":"add"]("Hidden"),t&&(this.e_counter.innerHTML=this.lst_cards.length)}}class Deck{constructor(t){this.lst_cards=[],this.lst_cards_out=[],this.nr_jokers=t,this.m43(t)}m43(t){for(var s,e,i,n=0,r=[],a=0;a<4;++a)for(i=this.m49(a),r.includes(i)||r.push(i),s=1;s<=13;++s)e=new Card(n++,{value:a,symbol:this.m48(a),color:i},{value:s,symbol:this.m50(s)}),this.lst_cards.push(e);for(var h=0,l=1;l<=t;++l)e=new Card(n++,{value:SUIT_JOKER,symbol:this.m48(SUIT_JOKER),color:r[h]},{value:ROYAL_JOKER,symbol:this.m50(s)}),this.lst_cards.push(e),h=(1+h)%r.length}f1(s){const e=Math.round(s/CARD_ASPECT_RATIO);return this.m44(t=>{null!==t&&t.m4(e,s)}),e}m44(t){this.lst_cards.forEach(t),this.lst_cards_out.forEach(t)}m45(){k10(this.lst_cards)}f53(){var t;return 0===this.lst_cards.length?null:(t=k14(this.lst_cards),this.lst_cards_out.push(t),t)}m46(){var t;return 0===this.lst_cards.length||0===(t=this.lst_cards.filter(t=>t.m21())).length?null:(t=k15(t),k12(this.lst_cards,t),this.lst_cards_out.push(t),t)}m47(){for(;this.lst_cards_out.length;)this.lst_cards.push(this.lst_cards_out.pop())}m48(s){return LST_SUITS.filter(t=>t.id===s).pop().symbol}m49(s){return LST_SUITS.filter(t=>t.id===s).pop().color}m50(s){return 1===s||11<=s&&s<=14?LST_ROYALS.filter(t=>t.value===s).pop().symbol:s}m51(t,s){return t.f66()+s.f66()}}class Dungeon extends FlexBox{constructor(){super("Dungeon","row","evenly","center",!0),this.lst_columns=[],this.lst_columns_hidden=[];for(var t,s=0;s<NR_DUNGOEN_COLUMNS;++s)t=new DungeonColumn(s),this.lst_columns.push(t),this.m7(t,!0,!0),A3.f22(t.m2())}m30(){var s=[];return this.lst_columns.forEach(t=>s=s.concat(t.m30())),this.lst_columns_hidden.forEach(t=>s=s.concat(t.m30())),s}m52(){for(var t;t=this.lst_columns_hidden.pop();)t.m27(!1),this.m7(t,!0,!0),A3.f22(t.m2())}m53(t){t=this.m54(t);t.m27(!0),this.lst_columns_hidden.push(t),this.m8(t,!0,!0),A3.f23(t.m2())}f1(t,s,e,i){super.f1(t,s,e,i),this.m9(Math.round(t/4*.9),s),this.m10()}m54(s){return this.lst_columns.filter(t=>t.m1()===s).pop()}m55(t,s){return this.m54(t).m55(s)}m56(t){return this.m55(t,ROYALS_AREA_ID)}m57(t){return this.m55(t,FIGHTERS_AREA_ID)}m58(){var s=0,e=0;return this.lst_columns.forEach(t=>{t.m61()&&(s+=1),t.m60()||(e+=1)}),s===e}}class DungeonColumn extends FlexBox{constructor(t){var s;super("DungeonColumn_"+t,"column","center","center",!0),this.id=t,this.element.classList.add("DungeonColumn"),this.hidden=!1,this.lst_areas=[];for(const e of[ROYALS_AREA_ID,FIGHTERS_AREA_ID])s=new DungeonColumnArea(e,t),e===ROYALS_AREA_ID&&s.m6(ROYALS_CONDENSE),this.lst_areas.push(s),this.m7(s,!0,!0),A3.f22(s.m2())}m30(){var s=[];return this.lst_areas.forEach(t=>s=s.concat(t.m30())),s}m1(){return this.id}m4(t,s){super.m4(t,s);var e=ROYALS_HEIGHT/(ROYALS_HEIGHT+3),i=3/(ROYALS_HEIGHT+3);this.lst_areas[0].m4(t,Math.floor(s*e)),this.lst_areas[1].m4(t,Math.floor(s*i))}m55(t){return this.lst_areas[t]}m59(t,s){this.lst_areas[s].f52(t)}m60(){return this.hidden}m27(s){this.hidden=s,this.element.classList[s?"add":"remove"]("Hidden"),this.lst_areas.forEach(t=>t.m27(s))}m61(){return this.lst_areas[FIGHTERS_AREA_ID].m63()&&1===this.lst_areas[ROYALS_AREA_ID].m40()}}class DungeonColumnArea extends FlexBox{constructor(t,s){super(["DungeonColumnArea",s,t].join("_"),"column",0===t?"end":"start","center",!0),this.id=t,this.column_id=s,this.element.classList.add("DungeonColumnArea"),this.element.classList.add("DungeonColumnArea"+(t===ROYALS_AREA_ID?"Royal":"Fighter")),t===FIGHTERS_AREA_ID?(this.element.classList.add("Clickable"),this.element.classList.add("FightersArea"),A0.f13(this.element,"MOUSE||TOUCH",this.onClick.bind(this)),this.element.addEventListener("contextmenu",A3.f47.bind(A3))):this.element.classList.add("RoyalsArea"),this.lst_cards=[],this.MAX_CARDS=this.id===ROYALS_AREA_ID?MAX_CARDS_ROYALS:MAX_CARDS_ATTACK}m30(){return this.lst_cards}f52(t){this.lst_cards.length===this.MAX_CARDS||this.lst_cards.includes(t)||(this.lst_cards.push(t),t.m28(!0),t.m14(this.id===FIGHTERS_AREA_ID||this.lst_cards.length===MAX_CARDS_ROYALS),t.m18(this),t.m29(this.lst_cards.length),this.m7(t,!1,!0))}m41(t){this.lst_cards.includes(t)&&(k12(this.lst_cards,t),this.m8(t,!1,!0),this.id===ROYALS_AREA_ID)&&1===this.lst_cards.length&&this.lst_cards[0].m14(!0)}onClick(t){t.stopPropagation(),t.preventDefault(),A3.f31(this)}m1(){return this.id}m62(){return this.column_id}m40(){return this.lst_cards.length}m39(){return 0===this.lst_cards.length}m63(){return this.lst_cards.length===this.MAX_CARDS}m64(){return this.id===FIGHTERS_AREA_ID}m65(){return this.m64()?this.lst_cards.slice(0,2):null}f53(t){return!this.m64()||this.lst_cards.length<=t?null:this.lst_cards[t]}m66(){return!this.m64()||this.lst_cards.length!==MAX_CARDS_ATTACK?null:this.lst_cards[MAX_CARDS_ATTACK-1]}m67(t){if(this.m64())return null;this.element.classList[t?"add":"remove"]("Attackable")}m68(){return this.m64()||this.lst_cards.length<1?null:this.lst_cards[this.lst_cards.length-1]}m69(){return this.m64()||this.lst_cards.length<=1?null:this.lst_cards[this.lst_cards.length-2]}m27(t){this.element.classList[t?"add":"remove"]("Hidden")}}class Hand extends FlexBox{constructor(){super("Hand","row","evenly","center",!0),this.lst_cards=[],this.element.classList.add("Clickable"),A0.f13(this.element,"MOUSE||TOUCH",this.onClick.bind(this)),this.element.addEventListener("contextmenu",A3.f47.bind(A3))}f1(t,s,e,i){super.f1(t,s,e,i),this.m10()}m30(){return this.lst_cards}f52(t){this.lst_cards.length===MAX_CARDS_HAND||this.lst_cards.includes(t)||(t.m28(!0),t.m18(this),t.m14(!0),t.m29(100+this.lst_cards.length),this.lst_cards.push(t),this.m7(t,!1,!0))}m41(t){this.lst_cards.includes(t)&&(k12(this.lst_cards,t),this.m8(t,!1,!0))}onClick(t){t.stopPropagation(),t.preventDefault(),A3.f33(this)}m39(){return 0===this.lst_cards.length}m63(){return this.lst_cards.length===MAX_CARDS_HAND}}class Messenger{constructor(t){this.element=document.createElement("div"),this.element.id="Messenger",this.txt=document.createElement("p"),this.element.appendChild(this.txt),this.show_time=t,this.timer=null}m70(t){this.show_time=t}m2(){return this.element}f1(t,s,e,i){this.element.style.width=t+"px",this.element.style.height=s+"px",this.element.style.left=i+"px",this.txt.style.fontSize=Math.min(Math.round(.25*s),17)+"px",this.f58()}f58(){this.element.style.top=-1.1*this.element.offsetHeight+"px"}f56(t,s){0<this.show_time&&(clearTimeout(this.timer),this.timer=setTimeout(this.f58.bind(this),this.show_time),this.txt.innerHTML="<span>"+t+"</span>: "+s,this.element.style.top=0)}m71(t){clearTimeout(this.timer),this.txt.innerHTML=t,this.element.style.top=0}}const DUNGEON_HAND_SPACING=.25,ROYALS_CONDENSE=.75,DUNGEON_WIDTH=.8,CARD_ASPECT_RATIO=16/11,DISTRIBUTE_ROYALS_SPEED=.2,DISTRIBUTE_HAND_SPEED=.2,DISTRIBUTE_KILL_SPEED=.5,_MAX_CARDS_AREA=3,NR_ROYALS=12,MAX_CARDS_ATTACK=3;var NR_DUNGOEN_COLUMNS=0,MAX_CARDS_ROYALS=0,ROYALS_HEIGHT=0,TOTAL_HEIGHT=0,DUNGEON_HEIGHT=0;const CARD_TRANSLATION_TIME=500,ROYALS_AREA_ID=0,FIGHTERS_AREA_ID=1,MAX_CARDS_HAND=3,SUIT_HEARTS=0,SUIT_SPADES=1,SUIT_DIAMONDS=2,SUIT_CLUBS=3,SUIT_JOKER=4;var ROYAL_JACK=11,ROYAL_QUEEN=12;const ROYAL_KING=13,ROYAL_JOKER=14,JOKER_MIN=2,JOKER_MAX=10,LST_SUITS_0=[{id:SUIT_HEARTS,symbol:"&hearts;",color:"Red"},{id:SUIT_SPADES,symbol:"&spades;",color:"Black"},{id:SUIT_DIAMONDS,symbol:"&diams;",color:"Red"},{id:SUIT_CLUBS,symbol:"&clubs;",color:"Black"},{id:SUIT_JOKER,symbol:"",color:""}],LST_ROYALS_0=[{value:"J",symbol:"J"},{value:"Q",symbol:"Q"},{value:ROYAL_KING,symbol:"K"},{value:ROYAL_JOKER,symbol:"&#x2605;"},{value:1,symbol:"A"}],LST_SUITS_1=[{id:SUIT_HEARTS,symbol:"&#x25B2;",color:"Red"},{id:SUIT_SPADES,symbol:"&#x25B2;",color:"Black"},{id:SUIT_DIAMONDS,symbol:"&#x25FC;",color:"Red"},{id:SUIT_CLUBS,symbol:"&#x25FC;",color:"Black"},{id:SUIT_JOKER,symbol:"",color:""}],LST_ROYALS_1=[{value:"J",symbol:"&#x268A;"},{value:"Q",symbol:"&#x268C;"},{value:ROYAL_KING,symbol:"&#x2630;"},{value:ROYAL_JOKER,symbol:"&#x25C9;"},{value:1,symbol:"1"}],LST_ROYALS_ALL=[LST_ROYALS_0,LST_ROYALS_1],LST_SUITS_ALL=[LST_SUITS_0,LST_SUITS_1];var LST_ROYALS=null,LST_SUITS=null;const A3={viewport:null,spacing:0,dungeon:null,hand:null,deck:null,draw_pile:null,discard_royals:null,discard_fighters:null,discard_graveyard:null,card_height:0,clicked_card:null,selected_card:null,in_game_stats:null,messenger:null,busy:!1};function k1(t){return document.getElementById(t)}function k2(t,s){return(s=s||document).getElementsByTagName(t)[0]}function k3(t,s){return(s=s||document).getElementsByTagName(t)}function k4(t,s=document){return s.querySelector(t)}function k5(t,s=document){return s.querySelectorAll(t)}function k6(t,s){for(s=s.toUpperCase();t.tagName!==s;)t=t.parentNode;return t}function k7(e,i=null){return new Promise((t,s)=>setTimeout(t,e,i))}function k8(t,s=null,e=null,i=null){t=new URL(window.location).searchParams.get(t);return null===t||(null!==e&&"string"!==e&&("int"===e?t=n(t=parseInt(t,10),i):"float"===e?t=n(t=parseFloat(t,10),i):"boolean"===e?t=Boolean(parseInt(t,10)):"uppercase"===e?t=t.toUpperCase():"lowercase"===e&&(t=t.toLowerCase())),["string","uppercase","lowercase"].includes(e)&&null!==i&&!i.includes(t))?s:t;function n(t,s){var e;return null!==s&&(e=s[0],s=s[1],t<e?t=e:s<t&&(t=s)),t}}function k10(t){for(var s=t.length-1;0<s;s--){var e=Math.floor(Math.random()*(s+1)),i=t[s];t[s]=t[e],t[e]=i}}function k11(t){return t.slice(0)}function k12(t,s){return t.includes(s)?t.splice(t.indexOf(s),1).pop():null}function k13(t,s){return s>=t.length?null:t.splice(s,1).pop()}function k14(t){return k13(t,Math.f83(0,t.length-1))}function k15(t){return t[Math.f83(0,t.length-1)]}A3.f0=function(){A0.f0(this.f1.bind(this)),A0.f11(A0.PAGE_LANDSCAPE,"Rotate"),A0.A2.f0("CTD"),this.viewport=k1("GameViewport"),this.in_game_stats=k1("InGameStats"),this.A6.f0(),this.A5.f0(),this.A5.f58(),this.deck=new Deck(this.A6.f66("nr_jokers")),this.dungeon=new Dungeon,this.hand=new Hand,this.draw_pile=new CardPile("DrawPile"),this.discard_royals=new CardPile("DiscardRoyals"),this.discard_fighters=new CardPile("DiscardFighters"),this.discard_graveyard=new CardPile("DiscardGraveyard"),this.messenger=new Messenger(1e3*this.A6.f66("warn_time")),document.body.appendChild(this.messenger.m2()),this.A6.f66("reuse_discard")?this.discard_fighters.m31(!0):k1("stats_reused").style.display="none",this.discard_fighters.m34(CARD_TRANSLATION_TIME),this.discard_royals.m34(CARD_TRANSLATION_TIME),this.discard_graveyard.m34(CARD_TRANSLATION_TIME),A0.f1(),k1("AppViewport").classList.remove("AppInit"),A0.f13(window,"contextmenu",this.f47.bind(this)),A0.f13(window,"MOUSE||TOUCH",this.f48.bind(this)),A0.f13(k1("HomeCard"),"MOUSE||TOUCH",this.f21.bind(this)),this.f51();var t=k8("goto","");"Play"===t?this.f21(null):""!==t&&A0.f6(t)},A3.f21=function(t){A0.f6("Play"),k1("MenuIcon").classList.remove("Hidden"),A3.A5.f56()},A3.f22=function(t){this.viewport.appendChild(t)},A3.f23=function(t){t.remove()},A3.f1=function(t,s){this.spacing=this.viewport.offsetTop;var t=Math.min(t-2*this.spacing,1.15*s),s=(this.viewport.style.width=Math.round(t)+"px",this.viewport.style.height=Math.round(window.visualViewport.height-2*this.spacing)+"px",this.A5.f57()||this.A5.f58(),Math.round(this.viewport.offsetWidth*DUNGEON_WIDTH)),t=Math.round(this.viewport.offsetHeight*DUNGEON_HEIGHT),e=(this.card_height=Math.round(this.viewport.offsetHeight*(1/TOTAL_HEIGHT)),this.deck.f1(this.card_height)),i=(this.dungeon.f1(s,t,0,0),this.hand.f1(s,this.card_height,t+this.card_height*DUNGEON_HAND_SPACING,0),this.viewport.offsetWidth-s-this.spacing),n=this.card_height,r=s+this.spacing,t=(this.draw_pile.f1(i,n,t+this.card_height*DUNGEON_HAND_SPACING,r,e,this.card_height),ROYALS_HEIGHT*this.card_height);this.discard_royals.f1(i,n,t,r,e,this.card_height),this.discard_graveyard.f1(i,n,t+ +this.card_height,r,e,this.card_height),this.discard_fighters.f1(i,n,t+2*this.card_height,r,e,this.card_height),this.in_game_stats.style.height=Math.round(ROYALS_HEIGHT*this.card_height-this.spacing)+"px",this.in_game_stats.style.width=i+"px",this.in_game_stats.style.fontSize=Math.round(.09*i)+"px",this.messenger.f1(s,(ROYALS_HEIGHT-1)*this.card_height,0,this.viewport.offsetLeft)},A3.f24=function(){return this.card_height},A3.f25=function(){this.busy||(this.busy=!0,k1("Menu_Play").classList.add("Hidden"),this.f48(),this.messenger.f58(),this.deck.m47(),this.deck.m45(),this.A7.f16(),this.A7.f77(),this.dungeon.m52(),this.f50().then(t=>this.f26()).then(t=>this.f27(DISTRIBUTE_ROYALS_SPEED)).then(t=>this.f28(DISTRIBUTE_HAND_SPEED)).then(t=>{this.draw_pile.m34(CARD_TRANSLATION_TIME),this.draw_pile.m42(!0),this.discard_fighters.m42(!0),this.A7.f76(),k1("Menu_Play").classList.remove("Hidden"),this.busy=!1}))},A3.f26=function(){for(;card=this.deck.m46();)this.f36(card,this.draw_pile,1);for(;card=this.deck.f53();)this.f36(card,this.draw_pile,-1);return Promise.resolve(null)},A3.f27=function(t=DISTRIBUTE_ROYALS_SPEED){for(var e=[],s=0;s<NR_DUNGOEN_COLUMNS;++s)for(var i=1;i<=MAX_CARDS_ROYALS;++i)e.push(s);k10(e);for(var n=[],r=0,a=CARD_TRANSLATION_TIME*t,i=NR_ROYALS;0<i--;)n.push(k7(r).then(t=>{var s=A3.draw_pile.m35();A3.dungeon.m55(e.pop(),0).f52(s)})),r+=a;return n.push(k7(3*CARD_TRANSLATION_TIME)),Promise.all(n)},A3.f28=function(t=DISTRIBUTE_HAND_SPEED){this.A4.f16();for(var s=[],e=0,i=CARD_TRANSLATION_TIME*t,n=Math.min(MAX_CARDS_HAND,this.draw_pile.m40());0<n--;)s.push(k7(e).then(t=>{var s=A3.draw_pile.m35();A3.hand.f52(s)})),e+=i;return s.push(k7(e)),Promise.all(s)},A3.f29=function(t){if(this.f48(),(this.clicked_card=t).m25())return t.m19(this.discard_fighters)&&this.f35()?void 0:void this.f45("Card","I'm face down, let me be.");var s=t.m20();s instanceof DungeonColumnArea&&s.m64()?this.f45("Attack card","Undo? Click your hand area. Attack? Click the royal."):s===this.discard_fighters&&null!==this.selected_card&&t!==this.selected_card?this.f35():t.m16()?(null!==this.selected_card&&this.selected_card.m15(!1),(this.selected_card=t).m21()&&(this.f30(),this.f37(t))&&(this.A7.f73("nr_attacks",1),this.f32(!0)),this.selected_card):this.selected_card=null},A3.f30=function(){this.selected_card instanceof Card&&this.selected_card.m15(!1),this.selected_card=null},A3.f31=function(t){this.f48();var s=this.dungeon.m56(t.m62());if(!s.m39())if(null===this.selected_card)t.m63()?this.f45("Prepare attack","I'm ready, click the royal card."):this.f45("Prepare attack","Select a card and play it here.");else{var e=this.selected_card.m20();if(e===this.hand||e===this.discard_fighters&&!this.selected_card.m25()){var i=s.m68();if(t.m40()<MAX_CARDS_ATTACK-1){if(!this.f43(i))return this.f30(),!1}else{if(!this.f41(this.selected_card,i))return this.f30(),!1;s.m67(!0)}e===this.discard_fighters?(this.A4.f54([this.selected_card]),this.A4.f54(t.m65()),this.A7.f73("reused",1)):this.A4.f52(this.selected_card),this.f36(this.selected_card,t),this.hand.m39()&&k7(CARD_TRANSLATION_TIME).then(t=>A3.f28()).then(t=>{A3.f32()})}}},A3.f32=function(t=!1){var s=0;t?this.A7.f74("nr_attacks")===NR_ROYALS&&(s=1):(this.dungeon.m58(),this.hand.m39()&&!this.dungeon.m58()&&(s=-1)),0!==s&&(this.A7.f77(),this.messenger.m71(1===s?"Congratulations! Up to another?":"Almost there... Try again!"))},A3.f33=function(t){var s,e;this.f48(),t.m63()?this.f45("Undo","Hand is full."):(s=this.A4.f53())instanceof Card?((e=s.m20())!==this.discard_fighters&&this.dungeon.m56(e.m62()).m67(!1),this.f36(s,t)):this.f45("Undo","Sorry, no card available.")},A3.f34=function(t){this.f48(),t!==this.discard_fighters?t===this.discard_royals?this.f45("Discard royals","I can manage myself, thanks."):t===this.discard_graveyard?this.f45("Graveyard","I can manage myself, thanks."):t===this.draw_pile&&this.f45("Draw pile","I can manage myself, thanks."):null===this.selected_card?this.f45("Discard fighters","Select a card from your hand."):this.f35()},A3.f35=function(){var t=this.selected_card;return null!==t&&!!t.m19(this.hand)&&(this.A4.f52(t),this.f49(t),this.hand.m39()&&k7(CARD_TRANSLATION_TIME).then(t=>A3.f28()).then(t=>{A3.f32()}),!0)},A3.f36=function(t,s,e=0){s instanceof FlexBox&&t instanceof Card&&(t.m20().m41(t),s===this.discard_fighters?s.m37(t):0===e?s.f52(t):1===e?s.m36(t):-1===e&&s.m37(t),this.f30())},A3.f37=function(t){var s,e,i,n=this.dungeon.m57(t.m20().m62());return n.m63()?(s=n.m66(),!(!this.f41(s,t)||([n,e]=n.m65(),(i=this.deck.m51(n,e))<t.f66())||(n.m22()||n.m22()||(i=i-t.f66(),this.A7.f73("overkill",i)),this.f44([t,n,e,s]),0))):(this.f45("Start attack","Place two attack cards and a trigger card."),!1)},A3.f38=function(t,s){return!this.A6.f66("joker_trigger_color")||t.m13()===s.m13()||(this.f45("Prepare attack","Trigger joker must match color."),!1)},A3.f39=function(t,s,e=!1){e=e?"ace_":"";if(this.A6.f66(e+"trigger_suit")){if(t.m12()!==s.m12())return this.f45("Prepare attack","Trigger card must match suit."),!1}else if(this.A6.f66(e+"trigger_color")&&t.m13()!==s.m13())return this.f45("Prepare attack","Trigger card must match color."),!1;e=this.A6.f66(e+"trigger_value");if("any"!==e){var[i,n]=this.dungeon.m57(s.m20().m62()).m65(),s=this.f42(s.f66(),i,n),i=t.f66();if("ge"===e){if(i<s)return this.f45("Prepare attack","Trigger card must be &ge; "+s+"."),!1}else if(i<=s)return this.f45("Prepare attack","Trigger card must be &gt; "+s+"."),!1}return!0},A3.f40=function(t,s){return this.f39(t,s,!0)},A3.f41=function(t,s){return t.m22()?this.f38(t,s):t.m23()?this.f40(t,s):this.f39(t,s)},A3.f42=function(t,s,e){var i=e.f66();return s.m22()?t-i:(s=s.f66(),e.m22()?t-s:Math.min(s,i))},A3.f43=function(t){var s,e=this.dungeon.m57(t.m20().m62()),i=e.f53(0);if(null===i?(i=this.selected_card,s=null):null===(s=e.f53(1))&&(s=this.selected_card),this.A6.f66("joker_attack_color")){var e=t.m13(),n=!0;if(null!==i&&i.m22()&&i.m13()!==e&&(n=!1),!(n=null!==s&&s.m22()&&s.m13()!==e?!1:n))return this.f45("Prepare attack","Attack joker must match color"),!1}e=null===i?0:i.f66(),n=null===s?0:s.f66(),i=t.f66();return 0===n?i<=e+10||(this.f45("Prepare attack",[i,"-",e,"&gt;",10].join(" ")),!1):i<=e+n||(this.f45("Prepare attack",[e,"+",n,"&lt;",i].join(" ")),!1)},A3.f44=function(t){const[s,e,i,n]=t;for(var r=[],a=0,h=CARD_TRANSLATION_TIME*DISTRIBUTE_KILL_SPEED,l=3;0<=l;)r.push(k7(a,t[l--]).then(t=>{t.m29(100+l),this.f49(t,!0)})),a+=h;r.push(k7(a));const o=this.dungeon.m57(n.m20().m62()),d=this.dungeon.m56(n.m20().m62()),_=s.m20().m69();Promise.all(r).then(t=>{d.m67(!1),this.A4.f54([e,i,n]),null!==_?_.m14(!0):this.dungeon.m53(o.m62())})},A3.f45=function(t,s){this.messenger.f56(t,s)},A3.f46=function(t,s){t===this.draw_pile&&s<=this.A6.f66("warn_draw_level")&&this.f45("Draw pile",s+" left.")},A3.f47=function(t){this.f48(),t.stopPropagation(),t.preventDefault(),t.target.click()},A3.f48=function(){A0.A1.f14()&&!A0.A1.f15()&&document.body.requestFullscreen&&document.body.requestFullscreen()},A3.f49=function(t,s=!1){t instanceof Card&&(t===this.selected_card&&this.f30(),t.m29(100),this.f36(t,t.m21()?this.discard_royals:s?this.discard_graveyard:this.discard_fighters))},A3.f50=function(){var t=[];t=(t=(t=(t=t.concat(this.discard_fighters.m30())).concat(this.hand.m30())).concat(this.dungeon.m30())).concat(this.draw_pile.m30());const e=CARD_TRANSLATION_TIME*DISTRIBUTE_ROYALS_SPEED;var i=[],n=0;return t.forEach(s=>{i.push(k7(n).then(t=>{this.f49(s,!0)})),n+=e}),i.push(k7(n+CARD_TRANSLATION_TIME)),Promise.all(i)},A3.f51=function(){for(var t;t=this.deck.f53();)(t.m21()?this.discard_royals:this.discard_graveyard).f52(t)},A3.A4={lst:[]},A3.A4.f16=function(){for(;this.lst.pop(););},A3.A4.f52=function(t){this.lst.includes(t),this.lst.push(t)},A3.A4.f53=function(){return 0===this.lst.length?null:this.lst.pop()},A3.A4.f54=function(t){0!==this.lst.length&&t.forEach(t=>{k12(this.lst,t)})},A3.A5={menu_pannel:null},A3.A5.f0=function(){this.menu_pannel=k1("MenuPannel"),A0.f13(k1("MenuIcon"),"MOUSE||TOUCH",A3.A5.f59.bind(A3.A5)),Array.from(k3("p",this.menu_pannel)).forEach(t=>{t.classList.add("Clickable"),A0.f13(t,"MOUSE||TOUCH",this.f55.bind(this))})},A3.A5.f55=function(t){t=t.target.id.split("_").pop();"Home"===t?(k1("MenuIcon").classList.add("Hidden"),A3.A5.f59()):"Play"===t?"Play"===A0.f8()&&A3.f25():"Options"===t&&A3.A6.f63(!1),A0.f6(t)},A3.A5.f56=function(){this.menu_pannel.style.right=0},A3.A5.f57=function(){return this.menu_pannel.style.right.length<=3},A3.A5.f58=function(){this.menu_pannel.style.right=-this.menu_pannel.offsetWidth+"px"},A3.A5.f59=function(t){this.f57()?this.f58():this.f56()},A3.A6={key:"options",data:{cards:{type:"int",value:0,values:[0,1],labels:["Default","Abstract"],restart:2},reuse_discard:{type:"boolean",value:!1,restart:2},royals_sequence:{type:"string",value:"JQK",values:["JQK","QJK"],restart:2},nr_jokers:{type:"int",value:2,values:[0,1,2,3,4],restart:2},show_royals_value:{type:"boolean",value:!0,restart:2},nr_columns:{type:"int",value:3,values:[3,4],restart:2},warn_time:{type:"int",value:4,values:[0,3,4,5],restart:0},warn_draw_level:{type:"int",value:6,values:[0,3,6,9],restart:0},trigger_suit:{type:"boolean",value:!0,restart:0},ace_trigger_suit:{type:"boolean",value:!0,restart:0},trigger_color:{type:"boolean",value:!0,restart:0},ace_trigger_color:{type:"boolean",value:!0,restart:0},trigger_value:{type:"string",value:"any",values:["any","ge","gt"],labels:["Unrelated","&ge;","&gt;"],restart:0},ace_trigger_value:{type:"string",value:"any",values:["any","ge","gt"],labels:["Unrelated","&ge;","&gt;"],restart:0},joker_trigger_color:{type:"boolean",value:!1,restart:0},joker_attack_color:{type:"boolean",value:!1,restart:0}}},A3.A6.f60=function(){var t,s={};for(t in this.data)s[t]=this.data[t].value;return s},A3.A6.f61=function(){A0.A2.f18(this.key,this.f60())},A3.A6.f62=function(t){for(var s in t)this.data[s].value=t[s]},A3.A6.f0=function(){var t=this.f60();A0.A2.f20(this.key,t)&&this.f62(t),1===this.data.cards.value&&(this.data.show_royals_value.value=!1,this.data.royals_sequence.value="JQK"),this.data.trigger_suit.value&&(this.data.trigger_color.value=!0),this.data.ace_trigger_suit.value&&(this.data.ace_trigger_color.value=!0);this.data;this.f64(),k1("stats_reused").style.display=this.data.reuse_discard.value?"":"none",this.f71(),this.f72()},A3.A6.f63=function(t){k1("OptionsApply").classList[t?"remove":"add"]("Hidden")},A3.A6.f64=function(){this.f63(!1);var t,s,e=k2("div",k1("Options"));for(t in this.data)(s=document.createElement("p")).classList.add("OptionsParagraph"),this.f68(t,s),e.appendChild(s);A0.f13(k1("OptionsApply"),"MOUSE||TOUCH",this.f65.bind(this))},A3.A6.f65=function(t){t.preventDefault(),t.stopPropagation();t=self.location.protocol+"//"+self.location.host+self.location.pathname;self.location=t+"?goto=Play"},A3.A6.f66=function(t){return this.data[t].value},A3.A6.f68=function(t,s){var e,i,n,r,a,h=this.data[t],l=document.createElement("span"),o=(l.classList.add("Restart_"+h.restart),l.innerHTML=t,s.appendChild(l),"boolean"===h.type?(e=["Yes","No"],a=!0):(a=!1,e=h.values),0);for(i of e)(n=document.createElement("input")).type="radio",n.id=t+"_"+i,n.name=t,n.value=a?"Yes"===i?1:0:i,n.checked=(a?"Yes"===i:i)===this.data[t].value,n.addEventListener("change",this.f69.bind(this)),(r=document.createElement("label")).for=n.id,void 0!==h.labels?r.innerHTML=h.labels[o]:r.innerHTML=i,s.appendChild(n),s.appendChild(r),++o},A3.A6.f69=function(t){var t=t.target,s=t.name,e=t.value;"int"===this.data[s].type?e=parseInt(e,10):"boolean"===this.data[s].type&&(e="1"===e),"warn_time"===s&&A3.messenger.m70(1e3*e),this.data[t.name].value=e,this.f61(),2===this.data[s].restart&&this.f63(!0)},A3.A6.f71=function(){NR_DUNGOEN_COLUMNS=this.data.nr_columns.value,MAX_CARDS_ROYALS=NR_ROYALS/NR_DUNGOEN_COLUMNS,ROYALS_HEIGHT=MAX_CARDS_ROYALS-(MAX_CARDS_ROYALS-1)*ROYALS_CONDENSE,TOTAL_HEIGHT=ROYALS_HEIGHT+MAX_CARDS_ATTACK+DUNGEON_HAND_SPACING+1,DUNGEON_HEIGHT=(ROYALS_HEIGHT+MAX_CARDS_ATTACK)/TOTAL_HEIGHT,LST_ROYALS=LST_ROYALS_ALL[this.data.cards.value],LST_SUITS=LST_SUITS_ALL[this.data.cards.value]},A3.A6.f72=function(){"QJK"===this.data.royals_sequence.value?(ROYAL_QUEEN=11,ROYAL_JACK=12):(ROYAL_JACK=11,ROYAL_QUEEN=12);for(var t of LST_ROYALS)"J"===t.value?t.value=ROYAL_JACK:"Q"===t.value&&(t.value=ROYAL_QUEEN)},A3.A7={keys:{reused:0,overkill:0,time:0,nr_attacks:0},timer:null},A3.A7.f73=function(t,s){this.keys[t]+=s;s=k1("txt_stats_"+t);return null!==s&&(s.innerHTML=this.keys[t]),this.keys[t]},A3.A7.f74=function(t){return this.keys[t]},A3.A7.f16=function(){this.keys.reused=0,this.keys.overkill=0,k1("txt_stats_reused").innerHTML=this.keys.reused,k1("txt_stats_overkill").innerHTML=this.keys.overkill,this.keys.time=0,this.keys.nr_attacks=0},A3.A7.f75=function(){this.f73("time",1),k1("txt_stats_time").innerHTML=this.keys.time,this.timer=setTimeout(this.f75.bind(this),1e3)},A3.A7.f76=function(){this.keys.time=0,k1("txt_stats_time").innerHTML=this.keys.time,this.timer=setTimeout(this.f75.bind(this),1e3)},A3.A7.f77=function(){clearTimeout(this.timer)},window.addEventListener("load",()=>{A3.f0()}),Math.f83=function(t,s){return Math.floor(Math.random()*(s-t+1))+t};